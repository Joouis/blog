---
title: 写在博客三周年
date: 2019-04-08 22:15:38
updated: 2019-04-14 23:05:00
categories:
- 技术人生谈
tags:
- blog
- anniversary
- hexo
- refactor
---

有的时候事情就是这么巧。比如这篇博文，不是特意为了三周年而写，而是刚好在这个时间节点博客有了一些质的变化，值得记录一下。

<!-- more -->

## 引

起因是今年过年的泰国游，准备在博客上记录第一篇游记。一直拖到现在还没动笔，除了年后工作比较忙外，也是考虑想给博客找一个合适的图床托管图片，毕竟游记涵盖大量照片。此外偶尔也想到过距离博客搭建起来已经很久，会不会最新的版本有一些新的特性可以用到，例如支持视频、音乐播放等。

于是，在清明假期的第一天，我看了下本博客用的 [NexT](https://github.com/theme-next/hexo-theme-next) 主题，发现都已经到了第七个版本，支持不少新特性，像是三方脚本可从 CDN 请求、支持 `quicklink`、代码可复制等等。翻着翻着，突然好奇自己的博客是从什么时候开始写的，查了下 commit，惊奇地发现是 2016.04.28，也就是说博客即将满三年咯！因此趁着假期，不如把博客好好整理、升级一下，就当三周年的纪念，也为后面书写、阅读更多内容提供更好的体验。

## 升级思路

关于博客是怎么搭建的当初建站之时就写了一篇[文章](https://blog.joouis.com/2016/04/09/build-a-blog-in-5-minutes/)，后面两年多的时间里添加了评论功能、小修小补了一些地方。照理说这类静态博客的核心就是文章，只要把文章转移到新的工程里，其他的工作量主要就在于配置。

因此首先更新了 HEXO 脚手架，用脚手架生成一个最新版的工程范例。对比原有博客的工程结构，把属于内容的部分抠出来，复制到新的工程里，主要是 `source` 目录下的东西。接着对照旧版 `_config.yml` 文件，一点点把新的填好就行了。这时候在本地起个服务看看，应该要和之前的博客长得一模一样，毕竟主题没变。

然后就是更新主题了。我并没有按照官方推荐的方式通过 `git clone` 把 `master` 分支的工程拉下来，而是出于习惯在 `releases` 下载了最新版本的 `zip` 文件解压到主题目录下。考虑到之前可能魔改过一些 layout 文件，这种做法不太可取，另外新版主题也可能已经升级过一些样式细节，因此我就只对照 `_config.yml` 文件重新配置主题好了，未来哪里看着不顺眼再改。

7.1.0 版本的 NexT 主题配置文件已经有一千两百多行，内容非常的丰富，看每一个配置也是学习博客功能的过程。就这么每一个配置都看看是干嘛的，旧的里面配过没、怎么配的，然后决定新的里要怎么配。通常依赖到 hexo 第三方库的功能，要额外 `yarn add` 一下；而主题自己支持的功能，通常以 `theme-next-` 开头，其实并不用把代码放到指定的 `source/js/` 目录下，因为配置已经支持 CDN，非常的方便！

在配置博客的过程中，可以通过 `hexo server` 本地起一个服务实时查看，有的配置也是通过打开查看的方式才知道是干嘛的。完成配置后，本地生成静态资源，通过脚手架推送到 `gh-pages` 分支，线上检查是否和本地调试的结果一致。另外有些问题，如百度打点推送功能，也只有线上环境才能验证。

此外，在整个升级过程中，由于新增了分类页、主页文章列表支持预览功能等等，对原本的博客也要进行一些对应的改造。后续更换图床后还会更新图片链接，补充一些标签以便发挥"相关热门文章"功能，甚至是给一些适合的文章添加合适的音乐 ;)

## 改善点

针对之前的博客，这次主要有以下更新：

- 为每篇博文添加 Creative Common 证书，选择 `BY-ND` 而非 `BY-NC-ND` 是考虑如果我的博文能帮助别人赚到钱，那么何乐而不为呢
- 将所有图片从 GitHub 迁移到了 OneDrive 上，后者的 CDN 极大提升了图片的可访问性与访问速度
- 优化了一些 SEO 配置项，更新了蜘蛛协议的 `robots.txt`，向 Google 和百度提交了 `sitemap.xml` 文件，不知道一个月后再看数据会不会有涨幅呢
- 预加载页面内的链接内容，加速访问体验
- 侧边栏
  - 社交媒体全部改成图标展示，增加了邮箱链接
  - 点击其他区域自动隐藏侧边栏
  - 移动端文章页支持展示侧边栏
- 博文
  - 首页支持博文预览
  - Meta 信息添加了博文更新时间、分类以及预计阅读时长
  - 代码区块支持复制
  - 添加相关热门文章阅读推荐
  - 添加打赏娱乐功能 XD
  - 自动对文章内容做空格处理
- 优化搜索方案，从以前的 Swifttype 改成本地索引方式，感觉很不错
- 升级 Fancybox 版本，图片浏览体验大大增强
- 添加 pace 进度条，加载体验也是好很多
- 支持页面阅读位置保存，这个功能最早在微信公众号上体验，阅读长文时很有用
- 隐藏了标签菜单入口，考虑到标签几十上百种太多太杂，不如留给分类，但是保留文章内的标签展示，类似一个二级入口
- 支持 Aplayer 音乐播放器
- 添加了一个小彩蛋，希望你能发现 LOL

## 尾巴

博客的升级花了大概两天的时间，一点点扣细节，既当技术又做产品，搞一个自嗨的项目，还是玩得非常开心。未来当然还是以输出文章为主，除了内容本身外，也试着丰富展现形式，达到一个比较舒服的阅读体验。最后就是博客的推广，其实建站之初只想做一个给自己看的空间，不过现在慢慢感受到，如果自己的文字能帮助到更多人，是一件正能量满满的事情。

等五周年时再看看会有什么变化吧~

{% meting "28737747" "netease" "song" "mini" "autoplay" %}