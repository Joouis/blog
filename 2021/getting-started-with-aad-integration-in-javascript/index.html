<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.2.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/hacker.ico">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/hacker.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/hacker.ico">
  <link rel="mask-icon" href="/images/hacker.ico" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.1/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css">

<script class="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"blog.joouis.com","root":"/","scheme":"Mist","version":"8.0.2","exturl":false,"sidebar":{"position":"right","display":"hide","padding":18,"offset":12},"copycode":true,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":true,"mediumzoom":false,"lazyload":true,"pangu":true,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}};
  </script>

  <meta name="description" content="My sharing for the UX team about the auth process, components and some empirical knowledges from the business.">
<meta property="og:type" content="article">
<meta property="og:title" content="Getting started with AAD integration in JavaScript">
<meta property="og:url" content="https://blog.joouis.com/2021/getting-started-with-aad-integration-in-javascript/index.html">
<meta property="og:site_name" content="江边的旱鸭子">
<meta property="og:description" content="My sharing for the UX team about the auth process, components and some empirical knowledges from the business.">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://bn1301files.storage.live.com/y4mbKIeUshzLY0PLLa56wbDQFDXeixR2mD8SGV3qgrlICWv9gzwy7hJ3lc24Ljg88Aty5krpu9Onhn7RdurcYtsRI3gv93CFnkNdQP4QakTv_4eYVO5Bs6xTZKlK2KU28Tg6FWhztJepjHUltLkDzOdQoKS0JCVmCKElL0oQ7-q20uVuA5BfafdQu6ABR3Vm5hK?width=1141&height=754&cropmode=none">
<meta property="og:image" content="https://bn1301files.storage.live.com/y4mKEw5-SJ-8saADw_GBd-p3uM8CeNIVSSIeM8rpqKNEMJUIQJVMRtDOg3HWZGdPpUEpgOAbGQiWUI95eY_2c15OyYsDKflxGWxxhQR73GaqjiW7befAS9rEF93PS9NVHzA_YcW3QxG4zkFSdc7QS4bRXlIqrFoaYNGS9KDpJcIijXwkW0ThNuVtrcia2ES1keJ?width=1820&height=1089&cropmode=none">
<meta property="og:image" content="https://bn1301files.storage.live.com/y4mclbM9lfWdcOe0X1dKhrjNYAOCZzK52V_EqIe5dx6qyAG1lURMvBWQlU1LJz8Qbw42xFY8wscyvros1ZMUx7yOrDeJRGVdwuDTui3k7EtkaBaDUcRaCnUZOqKCMtVlakWSl6T1i9mKGmEf5bnNMXj8wevxfmhOKws6xEKrkkRTzGb_-Tv5-hPQjENax5hsCT0?width=1928&height=1161&cropmode=none">
<meta property="og:image" content="https://bn1301files.storage.live.com/y4mb5PAIWyRmN97uqImMhRAHZkrCkK_tw3AReJ_Dmqtc3evRy791bae_3pjSEub5lHvil98pzNY3aiL5YaMbfEP1LRfpEsrKpk4-xVCCLJUMgl9JXka0UO69RjR0YVtWHg8a7IizTUk4Qay1lWdJgYh_Ju28Tk0eltkjZ7mP5QI6Z0LznRehOmnyF7ViqALoHrr?width=1319&height=863&cropmode=none">
<meta property="og:image" content="https://bn1301files.storage.live.com/y4mnLQosr7Z7_nxS_rVSvb0YPxm98sawmOYlQKq0ZKKoRrJxWsu1E_c29UoOEXRwpQA9zJCmFYRZkoh3c7oW4_bhcmsJ7vDU2vgsxmd5zo6dSK8b-_2i4uCa1Aplz_ojV3-Qym1yYTYpJXY4NxaRNvHOcuTJy-uAnCoxb2oMv0XHkMA-1EgeGdm4VruBuj_e4_g?width=1928&height=70&cropmode=none">
<meta property="og:image" content="https://bn1301files.storage.live.com/y4mgf0dFCtw_HTR9DZSyoMR4-srEHFSbwXeQO8D8gATlUzlPmdfxEqYDA-eh-68LAnbiBgLV8r8Uzv357s8vZKXV4x_br015B2Y_EYVpoEhGidzQJWU32IDqVENpB0TbUAC0Wxi6dbQWDywWVR11Oy9gbZdRumKU820wr1lX0eKYZJzv8naaNRNohaCmyKFoDAb?width=1181&height=227&cropmode=none">
<meta property="og:image" content="https://bn1301files.storage.live.com/y4moqXn1EubA0Ly99dJ-_pGS5mij26zCOwW7EhuDM0NFVC8HcnKk5Rq-GkA7c_yNnZAjZ4qapCyCfTbs-3LuE32gw375kfkxJY5aUn6f3sNKKD7B7neMJrK9UkVlWMwUX8wjMjLmP0p8S4jA3eSu1IvrOPRskK0vF-FDeC390zsvNGFmU1xgmxHzw-MNsAz8uXj?width=1554&height=993&cropmode=none">
<meta property="article:published_time" content="2021-04-14T00:05:13.000Z">
<meta property="article:modified_time" content="2021-04-15T04:57:00.000Z">
<meta property="article:author" content="John Chou">
<meta property="article:tag" content="oauth">
<meta property="article:tag" content="azure">
<meta property="article:tag" content="aad">
<meta property="article:tag" content="auth">
<meta property="article:tag" content="msal">
<meta property="article:tag" content="microsoft-identity">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://bn1301files.storage.live.com/y4mbKIeUshzLY0PLLa56wbDQFDXeixR2mD8SGV3qgrlICWv9gzwy7hJ3lc24Ljg88Aty5krpu9Onhn7RdurcYtsRI3gv93CFnkNdQP4QakTv_4eYVO5Bs6xTZKlK2KU28Tg6FWhztJepjHUltLkDzOdQoKS0JCVmCKElL0oQ7-q20uVuA5BfafdQu6ABR3Vm5hK?width=1141&height=754&cropmode=none">


<link rel="canonical" href="https://blog.joouis.com/2021/getting-started-with-aad-integration-in-javascript/">


<script class="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>Getting started with AAD integration in JavaScript | 江边的旱鸭子</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-76188004-1"></script>
    <script>
      if (CONFIG.hostname === location.hostname) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'UA-76188004-1');
      }
    </script>


  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?199f195e233fd5ecca0d9346d3259670";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  <noscript>
  <style>
  body { margin-top: 2rem; }

  .use-motion .menu-item,
  .use-motion .sidebar,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header {
    visibility: visible;
  }

  .use-motion .header,
  .use-motion .site-brand-container .toggle,
  .use-motion .footer { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle,
  .use-motion .custom-logo-image {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line {
    transform: scaleX(1);
  }

  .search-pop-overlay, .sidebar-nav { display: none; }
  .sidebar-panel { display: block; }
  </style>
</noscript>

<style>mjx-container[jax="SVG"] {
  direction: ltr;
}

mjx-container[jax="SVG"] > svg {
  overflow: visible;
}

mjx-container[jax="SVG"] > svg a {
  fill: blue;
  stroke: blue;
}

mjx-container[jax="SVG"][display="true"] {
  display: block;
  text-align: center;
  margin: 1em 0;
}

mjx-container[jax="SVG"][justify="left"] {
  text-align: left;
}

mjx-container[jax="SVG"][justify="right"] {
  text-align: right;
}

g[data-mml-node="merror"] > g {
  fill: red;
  stroke: red;
}

g[data-mml-node="merror"] > rect[data-background] {
  fill: yellow;
  stroke: none;
}

g[data-mml-node="mtable"] > line[data-line] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > rect[data-frame] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > .mjx-dashed {
  stroke-dasharray: 140;
}

g[data-mml-node="mtable"] > .mjx-dotted {
  stroke-linecap: round;
  stroke-dasharray: 0,140;
}

g[data-mml-node="mtable"] > svg {
  overflow: visible;
}

[jax="SVG"] mjx-tool {
  display: inline-block;
  position: relative;
  width: 0;
  height: 0;
}

[jax="SVG"] mjx-tool > mjx-tip {
  position: absolute;
  top: 0;
  left: 0;
}

mjx-tool > mjx-tip {
  display: inline-block;
  padding: .2em;
  border: 1px solid #888;
  font-size: 70%;
  background-color: #F8F8F8;
  color: black;
  box-shadow: 2px 2px 5px #AAAAAA;
}

g[data-mml-node="maction"][data-toggle] {
  cursor: pointer;
}

mjx-status {
  display: block;
  position: fixed;
  left: 1em;
  bottom: 1em;
  min-width: 25%;
  padding: .2em .4em;
  border: 1px solid #888;
  font-size: 90%;
  background-color: #F8F8F8;
  color: black;
}

foreignObject[data-mjx-xml] {
  font-family: initial;
  line-height: normal;
  overflow: visible;
}

.MathJax path {
  stroke-width: 3;
}

mjx-container[display="true"] {
  overflow: auto hidden;
}

mjx-container[display="true"] + br {
  display: none;
}
</style><link rel="alternate" href="/atom.xml" title="江边的旱鸭子" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">江边的旱鸭子</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">Blog of Joou</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section">首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section">归档</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section">分类</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section">关于</a>

  </li>
        <li class="menu-item menu-item-recruit">

    <a href="/recruit/" rel="section">招聘</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger">搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <section class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Relationship-between-OAuth2-0-AAD-and-MSAL"><span class="nav-number">1.</span> <span class="nav-text">Relationship between OAuth2.0, AAD and MSAL</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Definitions"><span class="nav-number">1.1.</span> <span class="nav-text">Definitions</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#OAuth-2-0"><span class="nav-number">1.1.1.</span> <span class="nav-text">OAuth 2.0</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Azure-Authentication-Directory"><span class="nav-number">1.1.2.</span> <span class="nav-text">Azure Authentication Directory</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Microsoft-Authentication-Libraries"><span class="nav-number">1.1.3.</span> <span class="nav-text">Microsoft Authentication Libraries</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Usage-scenario"><span class="nav-number">1.2.</span> <span class="nav-text">Usage scenario</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Workflow-and-implementation"><span class="nav-number">2.</span> <span class="nav-text">Workflow and implementation</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Authentication-flow"><span class="nav-number">2.1.</span> <span class="nav-text">Authentication flow</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Two-APIs"><span class="nav-number">2.1.1.</span> <span class="nav-text">Two APIs</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Redirect-URI-setup"><span class="nav-number">2.1.2.</span> <span class="nav-text">Redirect URI setup</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Configuration-on-Azure-Portal"><span class="nav-number">2.1.3.</span> <span class="nav-text">Configuration on Azure Portal</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#oauth-html"><span class="nav-number">2.1.4.</span> <span class="nav-text">oauth.html</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Code-configuration"><span class="nav-number">2.1.5.</span> <span class="nav-text">Code configuration</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Authority"><span class="nav-number">2.1.6.</span> <span class="nav-text">Authority</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Scopes-and-permissions"><span class="nav-number">2.1.7.</span> <span class="nav-text">Scopes and permissions</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Sign-in-with-redirect"><span class="nav-number">2.2.</span> <span class="nav-text">Sign-in with redirect</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Authorization-code"><span class="nav-number">2.2.1.</span> <span class="nav-text">Authorization code</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Acquire-a-token-with-a-redirect"><span class="nav-number">2.3.</span> <span class="nav-text">Acquire a token with a redirect</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Why-use-redirect-way"><span class="nav-number">2.3.1.</span> <span class="nav-text">Why use redirect way?</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Choice-of-MSAL-js"><span class="nav-number">2.4.</span> <span class="nav-text">Choice of MSAL.js</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Frequently-asked-issues"><span class="nav-number">3.</span> <span class="nav-text">Frequently asked issues</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Debugging-and-verification-approach"><span class="nav-number">3.1.</span> <span class="nav-text">Debugging and verification approach</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Difference-between-access-token-ID-token-and-refresh-token"><span class="nav-number">3.2.</span> <span class="nav-text">Difference between access token, ID token, and refresh token</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#How-to-change-token-expiration-time"><span class="nav-number">3.3.</span> <span class="nav-text">How to change token expiration time?</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#InteractionRequiredAuthError-AADSTS50058-A-silent-sign-in-request-was-sent-but-no-user-is-signed-in"><span class="nav-number">3.4.</span> <span class="nav-text">InteractionRequiredAuthError: AADSTS50058: A silent sign-in request was sent but no user is signed in.</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#The-frame-attempting-navigation-of-the-top-level-window-is-sandboxed-but-the-flag-of-%E2%80%98allow-top-navigation%E2%80%99-or-%E2%80%98allow-top-navigation-by-user-activation%E2%80%99-is-not-set"><span class="nav-number">3.5.</span> <span class="nav-text">The frame attempting navigation of the top-level window is sandboxed, but the flag of ‘allow-top-navigation’ or ‘allow-top-navigation-by-user-activation’ is not set.</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#BrowserAuthError-pcke-not-created-The-PCKE-code-challenge-and-verifier-could-not-be-generated"><span class="nav-number">3.6.</span> <span class="nav-text">BrowserAuthError: pcke_not_created: The PCKE code challenge and verifier could not be generated.</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#References"><span class="nav-number">4.</span> <span class="nav-text">References</span></a></li></ol></div>
        </section>
        <!--/noindex-->

        <section class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="John Chou"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">John Chou</p>
  <div class="site-description" itemprop="description">Stand high, think different.</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">56</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">9</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">198</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/Joouis" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Joouis" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:luckyjoou@gmail.com" title="E-Mail → mailto:luckyjoou@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.instagram.com/Joouis" title="Instagram → https:&#x2F;&#x2F;www.instagram.com&#x2F;Joouis" rel="noopener" target="_blank"><i class="fab fa-instagram fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="http://www.slideshare.net/choujohn351" title="SlideShare → http:&#x2F;&#x2F;www.slideshare.net&#x2F;choujohn351" rel="noopener" target="_blank"><i class="fab fa-slideshare fa-fw"></i></a>
      </span>
  </div>
  <div class="cc-license site-overview-item animated" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nd/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nd.svg" alt="Creative Commons"></a>
  </div>



        </section>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">
      

      

  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://blog.joouis.com/2021/getting-started-with-aad-integration-in-javascript/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="John Chou">
      <meta itemprop="description" content="Stand high, think different.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="江边的旱鸭子">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Getting started with AAD integration in JavaScript
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-04-14 08:05:13" itemprop="dateCreated datePublished" datetime="2021-04-14T08:05:13+08:00">2021-04-14</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-04-15 12:57:00" itemprop="dateModified" datetime="2021-04-15T12:57:00+08:00">2021-04-15</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Web-%E5%89%8D%E7%AB%AF/" itemprop="url" rel="index"><span itemprop="name">Web 前端</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/2021/getting-started-with-aad-integration-in-javascript/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2021/getting-started-with-aad-integration-in-javascript/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>8 分钟</span>
    </span>
</div>

            <div class="post-description">My sharing for the UX team about the auth process, components and some empirical knowledges from the business.</div>
        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h2 id="Relationship-between-OAuth2-0-AAD-and-MSAL"><a href="#Relationship-between-OAuth2-0-AAD-and-MSAL" class="headerlink" title="Relationship between OAuth2.0, AAD and MSAL"></a>Relationship between OAuth2.0, AAD and MSAL</h2><h3 id="Definitions"><a href="#Definitions" class="headerlink" title="Definitions"></a>Definitions</h3><h4 id="OAuth-2-0"><a href="#OAuth-2-0" class="headerlink" title="OAuth 2.0"></a>OAuth 2.0</h4><p>OAuth 2.0 is the industry-standard <strong>protocol</strong> for authorization. OAuth 2.0 focuses on client developer simplicity while providing specific authorization flows for web applications, desktop applications, mobile phones, and living room devices.</p>
<h4 id="Azure-Authentication-Directory"><a href="#Azure-Authentication-Directory" class="headerlink" title="Azure Authentication Directory"></a>Azure Authentication Directory</h4><p>One of OAuth 2.0 and OpenID Connect standard-compliant authentication <strong>service</strong> enabling developers to authenticate work or school accounts. It’s the implementation which supports OAuth 2.0. It’s the component of Microsoft Identity platform.</p>
<h4 id="Microsoft-Authentication-Libraries"><a href="#Microsoft-Authentication-Libraries" class="headerlink" title="Microsoft Authentication Libraries"></a>Microsoft Authentication Libraries</h4><p>Open source <strong>libraries</strong> for <strong>several clients</strong> to authenticate users using AAD, Microsoft personal accounts (MSA), and social identity providers like Facebook, Google, LinkedIn, Microsoft accounts, etc.</p>
<h3 id="Usage-scenario"><a href="#Usage-scenario" class="headerlink" title="Usage scenario"></a>Usage scenario</h3><p><img data-src="https://bn1301files.storage.live.com/y4mbKIeUshzLY0PLLa56wbDQFDXeixR2mD8SGV3qgrlICWv9gzwy7hJ3lc24Ljg88Aty5krpu9Onhn7RdurcYtsRI3gv93CFnkNdQP4QakTv_4eYVO5Bs6xTZKlK2KU28Tg6FWhztJepjHUltLkDzOdQoKS0JCVmCKElL0oQ7-q20uVuA5BfafdQu6ABR3Vm5hK?width=1141&height=754&cropmode=none"></p>
<h2 id="Workflow-and-implementation"><a href="#Workflow-and-implementation" class="headerlink" title="Workflow and implementation"></a>Workflow and implementation</h2><h3 id="Authentication-flow"><a href="#Authentication-flow" class="headerlink" title="Authentication flow"></a>Authentication flow</h3><p><img data-src="https://bn1301files.storage.live.com/y4mKEw5-SJ-8saADw_GBd-p3uM8CeNIVSSIeM8rpqKNEMJUIQJVMRtDOg3HWZGdPpUEpgOAbGQiWUI95eY_2c15OyYsDKflxGWxxhQR73GaqjiW7befAS9rEF93PS9NVHzA_YcW3QxG4zkFSdc7QS4bRXlIqrFoaYNGS9KDpJcIijXwkW0ThNuVtrcia2ES1keJ?width=1820&height=1089&cropmode=none"></p>
<h4 id="Two-APIs"><a href="#Two-APIs" class="headerlink" title="Two APIs"></a>Two APIs</h4><p>Only two APIs requested from client-side, very simple. Notice that <code>/oauth2/v2.0/authorize</code> is <code>document</code> type.</p>
<p><img data-src="https://bn1301files.storage.live.com/y4mclbM9lfWdcOe0X1dKhrjNYAOCZzK52V_EqIe5dx6qyAG1lURMvBWQlU1LJz8Qbw42xFY8wscyvros1ZMUx7yOrDeJRGVdwuDTui3k7EtkaBaDUcRaCnUZOqKCMtVlakWSl6T1i9mKGmEf5bnNMXj8wevxfmhOKws6xEKrkkRTzGb_-Tv5-hPQjENax5hsCT0?width=1928&height=1161&cropmode=none"></p>
<h4 id="Redirect-URI-setup"><a href="#Redirect-URI-setup" class="headerlink" title="Redirect URI setup"></a>Redirect URI setup</h4><p>For CORS and redirect target from sign-in page usage, should configure it on both Azure Portal and codebase.</p>
<h4 id="Configuration-on-Azure-Portal"><a href="#Configuration-on-Azure-Portal" class="headerlink" title="Configuration on Azure Portal"></a>Configuration on Azure Portal</h4><p><img data-src="https://bn1301files.storage.live.com/y4mb5PAIWyRmN97uqImMhRAHZkrCkK_tw3AReJ_Dmqtc3evRy791bae_3pjSEub5lHvil98pzNY3aiL5YaMbfEP1LRfpEsrKpk4-xVCCLJUMgl9JXka0UO69RjR0YVtWHg8a7IizTUk4Qay1lWdJgYh_Ju28Tk0eltkjZ7mP5QI6Z0LznRehOmnyF7ViqALoHrr?width=1319&height=863&cropmode=none"></p>
<h4 id="oauth-html"><a href="#oauth-html" class="headerlink" title="oauth.html"></a>oauth.html</h4><p>Usually we will set two reply URIs, one is probably the homepage as redirect target after signed in, another is used for requesting token silently. The silent token refresh loads an iframe using that empty <code>oauth.html</code> file, and that same <code>oauth.html</code> file needs to receive the response back, so the acquire token silent flow provides the <code>/oauth.html</code> endpoint as the redirect URI. This is different from the user-facing flow because there is no iframe that the middleware loads into the page, redirecting back to <code>oauth.html</code> will not hook into React or MSAL and auth would halt – it must redirect back to your react app in the user-facing flow.</p>
<h4 id="Code-configuration"><a href="#Code-configuration" class="headerlink" title="Code configuration"></a>Code configuration</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> config = &#123;</span><br><span class="line">    auth: &#123;</span><br><span class="line">        <span class="comment">// The application ID of your AAD application</span></span><br><span class="line">        clientId: <span class="string">&quot;11111111-1111-1111-111111111111&quot;</span>,</span><br><span class="line">        <span class="comment">// The authority URL for your application</span></span><br><span class="line">        authority: <span class="string">&quot;https://login.microsoftonline.com/common&quot;</span>,</span><br><span class="line">        <span class="comment">// Defaults to application start page</span></span><br><span class="line">        redirectUri: <span class="string">&quot;https://localhost:3000&quot;</span>,</span><br><span class="line">        postLogoutRedirectUri: <span class="string">&quot;https://localhost:3000/logout&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> loginRequest = &#123;</span><br><span class="line">    scopes: [<span class="string">`<span class="subst">$&#123;resourceEndpoint&#125;</span>/.default`</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Authority"><a href="#Authority" class="headerlink" title="Authority"></a>Authority</h4><p>The authority is a URL that indicates a directory that MSAL can request tokens from, for more details check the <a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/azure/active-directory/develop/msal-client-application-configuration">MSAL Application configuration options</a>.</p>
<h4 id="Scopes-and-permissions"><a href="#Scopes-and-permissions" class="headerlink" title="Scopes and permissions"></a>Scopes and permissions</h4><p>Applications that integrate with the Microsoft identity platform follow an authorization model that gives users and administrators control over how data can be accessed. <code>/.default</code> represents OpenID Connect scopes, for more details check the <a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/azure/active-directory/develop/v2-permissions-and-consent">Permissions and consent in the Microsoft identity platform</a>.</p>
<h3 id="Sign-in-with-redirect"><a href="#Sign-in-with-redirect" class="headerlink" title="Sign-in with redirect"></a>Sign-in with redirect</h3><p>It’s no need to redirect to sign-in page every time if auth is not expired, just go ahead. You can also <a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/azure/active-directory/develop/scenario-spa-sign-in?tabs=javascript2#sign-in-with-a-pop-up-window">sign-in with a pop-up window</a>.</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> username = <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> msalInstance = <span class="keyword">new</span> PublicClientApplication(config);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">handleResponse</span>(<span class="params">response</span>) </span>&#123;</span><br><span class="line">    <span class="comment">//handle redirect response</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// In case multiple accounts exist, you can select</span></span><br><span class="line">    <span class="keyword">const</span> currentAccounts = msalInstance.getAllAccounts();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (currentAccounts === <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">// No accounts detected, need to login</span></span><br><span class="line">        msalInstance.loginRedirect(loginRequest);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (currentAccounts.length &gt; <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="comment">// Add choose account code here</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (currentAccounts.length === <span class="number">1</span>) &#123;</span><br><span class="line">        username = currentAccounts[<span class="number">0</span>].username;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">msalInstance.handleRedirectPromise().then(handleResponse);</span><br></pre></td></tr></table></figure>

<h4 id="Authorization-code"><a href="#Authorization-code" class="headerlink" title="Authorization code"></a>Authorization code</h4><p>After signed in successfully, page will redirect to the redirect URI we set before with the authorization code. MSAL.js library will handle it automatically, we can observe the code on the navigation bar.</p>
<p><img data-src="https://bn1301files.storage.live.com/y4mnLQosr7Z7_nxS_rVSvb0YPxm98sawmOYlQKq0ZKKoRrJxWsu1E_c29UoOEXRwpQA9zJCmFYRZkoh3c7oW4_bhcmsJ7vDU2vgsxmd5zo6dSK8b-_2i4uCa1Aplz_ojV3-Qym1yYTYpJXY4NxaRNvHOcuTJy-uAnCoxb2oMv0XHkMA-1EgeGdm4VruBuj_e4_g?width=1928&height=70&cropmode=none"></p>
<p>Then the library will parse the authorization code and send the request to get token back directly, all logics encapsulated. Here is the structure of the decoded code.</p>
<p><img data-src="https://bn1301files.storage.live.com/y4mgf0dFCtw_HTR9DZSyoMR4-srEHFSbwXeQO8D8gATlUzlPmdfxEqYDA-eh-68LAnbiBgLV8r8Uzv357s8vZKXV4x_br015B2Y_EYVpoEhGidzQJWU32IDqVENpB0TbUAC0Wxi6dbQWDywWVR11Oy9gbZdRumKU820wr1lX0eKYZJzv8naaNRNohaCmyKFoDAb?width=1181&height=227&cropmode=none"></p>
<h3 id="Acquire-a-token-with-a-redirect"><a href="#Acquire-a-token-with-a-redirect" class="headerlink" title="Acquire a token with a redirect"></a>Acquire a token with a redirect</h3><p>The pattern for acquiring tokens for APIs with MSAL.js is to first attempt a silent token request by using the <code>acquireTokenSilent</code> method. When this method is called, the library first checks the cache in browser storage to see if a valid token exists and returns it. When no valid token is in the cache, it sends a silent token request to AAD from a hidden iframe.</p>
<p>The silent token requests to AAD might fail for reasons like an expired Azure AD session or a password change. In that case, we need to redirect or using a pop-up window to acquire tokens.</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> accessTokenRequest: AuthenticationParameters = &#123;</span><br><span class="line">    scopes: [<span class="string">`<span class="subst">$&#123;resourceEndpoint&#125;</span>/.default`</span>],</span><br><span class="line">    authority: <span class="built_in">this</span>.authority,</span><br><span class="line">    redirectUri: <span class="string">&quot;https://localhost:3000/oauth.html&quot;</span>,</span><br><span class="line">    account: <span class="built_in">this</span>.account</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">msalInstance.acquireTokenSilent(accessTokenRequest).then(<span class="function"><span class="keyword">function</span>(<span class="params">accessTokenResponse</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// Acquire token silent success</span></span><br><span class="line">    <span class="comment">// Call API with token</span></span><br><span class="line">    <span class="keyword">let</span> accessToken = accessTokenResponse.accessToken;</span><br><span class="line">&#125;).catch(<span class="function"><span class="keyword">function</span> (<span class="params">error</span>) </span>&#123;</span><br><span class="line">    <span class="comment">//Acquire token silent failure, and send an interactive request</span></span><br><span class="line">    <span class="built_in">console</span>.log(error);</span><br><span class="line">    <span class="keyword">if</span> (error.errorMessage.indexOf(<span class="string">&quot;interaction_required&quot;</span>) !== -<span class="number">1</span>) &#123;</span><br><span class="line">        msalInstance.acquireTokenRedirect(accessTokenRequest);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="Why-use-redirect-way"><a href="#Why-use-redirect-way" class="headerlink" title="Why use redirect way?"></a>Why use redirect way?</h4><p>If users have browser constraints or policies where pop-ups windows are disabled, you can use the redirect method. Use the redirect method with the Internet Explorer browser, because there are <a target="_blank" rel="noopener" href="https://github.com/AzureAD/microsoft-authentication-library-for-js/wiki/Known-issues-on-IE-and-Edge-Browser">known issues with pop-up windows on Internet Explorer</a>.</p>
<h3 id="Choice-of-MSAL-js"><a href="#Choice-of-MSAL-js" class="headerlink" title="Choice of MSAL.js"></a>Choice of MSAL.js</h3><p>You will find so many packages when you visit MSAL.js repository, APIs used above should be compatible across the packages, then question comes: how to make a choice?</p>
<p>Besides node package using in the server-side, I recommend <code>msal-browser</code> (<a target="_blank" rel="noopener" href="https://github.com/AzureAD/microsoft-authentication-library-for-js/blob/dev/lib/msal-browser">Microsoft Authentication Library for JavaScript v2.x</a>) or other UI framework wrappers based on it, for its implementation of OAuth 2.0 Authorization Code Flow with PCKE as well as it’s OpenID-compliant.</p>
<p><img data-src="https://bn1301files.storage.live.com/y4moqXn1EubA0Ly99dJ-_pGS5mij26zCOwW7EhuDM0NFVC8HcnKk5Rq-GkA7c_yNnZAjZ4qapCyCfTbs-3LuE32gw375kfkxJY5aUn6f3sNKKD7B7neMJrK9UkVlWMwUX8wjMjLmP0p8S4jA3eSu1IvrOPRskK0vF-FDeC390zsvNGFmU1xgmxHzw-MNsAz8uXj?width=1554&height=993&cropmode=none"></p>
<p>These packages are just official engineering implementations, not so well-documented yet, I had to read the source code for debugging before. Anyway as long as you master the workflow of authentication, it would not be too complicated.</p>
<h2 id="Frequently-asked-issues"><a href="#Frequently-asked-issues" class="headerlink" title="Frequently asked issues"></a>Frequently asked issues</h2><h3 id="Debugging-and-verification-approach"><a href="#Debugging-and-verification-approach" class="headerlink" title="Debugging and verification approach"></a>Debugging and verification approach</h3><p>You can’t verify your change until the production release, also the change for the production environment can’t be verified on other staging environment since they are using different hosts. So the question is how to debug or do verification?</p>
<p>Basically you can run a local server to host your application with adding a host record which points the production host to your local IP address like <code>127.0.0.1</code> to make it. Remember to enable HTTPS protocol for your local server.</p>
<p>And it’s better to verify your change on both common window and incognito window after the release.</p>
<h3 id="Difference-between-access-token-ID-token-and-refresh-token"><a href="#Difference-between-access-token-ID-token-and-refresh-token" class="headerlink" title="Difference between access token, ID token, and refresh token"></a>Difference between access token, ID token, and refresh token</h3><p>We observed that <code>/oauth2/v2.0/token</code> return 3 tokens: <code>access_token</code>,  <code>id_token</code> and <code>refresh_token</code>.</p>
<p><code>access_token</code> enables clients to securely call protected web APIs, and are used by web APIs to perform authentication and authorization. For more details please check <a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/azure/active-directory/develop/access-tokens">Microsoft identity platform access tokens</a>.</p>
<p><code>id_token</code> should be used to validate that a user is who they claim to be and get additional useful information about them, it can be sent alongside or instead of an access token. We have not used it. For more details please check <a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/azure/active-directory/develop/id-tokens">Microsoft identity platform ID tokens</a>.</p>
<p><code>access_token</code> and <code>id_token</code> are both JWT which consists of a header, payload, and signature portion, that’s why they look so similiar though these two strings are base64 encoded. We mainly use access token for the application, it contains more information than ID token, and we can get user info like name, E-mail from it.</p>
<p>Because access tokens are valid for only a short period of time, authorization servers will sometimes issue a refresh token at the same time the access token is issued. MSAL.js will exchange the <code>refresh_token</code> while request token silently for a new access token when needed.</p>
<h3 id="How-to-change-token-expiration-time"><a href="#How-to-change-token-expiration-time" class="headerlink" title="How to change token expiration time?"></a>How to change token expiration time?</h3><p>Please check this <a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/31162257/azure-oauth-how-to-change-token-expiration-time">answer from StackOverflow</a>.</p>
<h3 id="InteractionRequiredAuthError-AADSTS50058-A-silent-sign-in-request-was-sent-but-no-user-is-signed-in"><a href="#InteractionRequiredAuthError-AADSTS50058-A-silent-sign-in-request-was-sent-but-no-user-is-signed-in" class="headerlink" title="InteractionRequiredAuthError: AADSTS50058: A silent sign-in request was sent but no user is signed in."></a>InteractionRequiredAuthError: AADSTS50058: A silent sign-in request was sent but no user is signed in.</h3><p>This error need interaction sign in, thus catch the error and call <code>acquireTokenRedirect</code> method to sign in.</p>
<p>If the error message contains like this “The cookies used to represent the user’s session were not sent in the request to Azure AD. This could happen if the user is using Internet Explorer or Edge, and the web app sending the silent sign-in request is in different IE security zone than the Azure AD endpoint (login.microsoftonline.com).”, upgrade your MSAL.js v1.x to v2.x. Check more details <a target="_blank" rel="noopener" href="https://github.com/AzureAD/microsoft-authentication-library-for-js/issues/1765">here</a>.</p>
<h3 id="The-frame-attempting-navigation-of-the-top-level-window-is-sandboxed-but-the-flag-of-‘allow-top-navigation’-or-‘allow-top-navigation-by-user-activation’-is-not-set"><a href="#The-frame-attempting-navigation-of-the-top-level-window-is-sandboxed-but-the-flag-of-‘allow-top-navigation’-or-‘allow-top-navigation-by-user-activation’-is-not-set" class="headerlink" title="The frame attempting navigation of the top-level window is sandboxed, but the flag of ‘allow-top-navigation’ or ‘allow-top-navigation-by-user-activation’ is not set."></a>The frame attempting navigation of the top-level window is sandboxed, but the flag of ‘allow-top-navigation’ or ‘allow-top-navigation-by-user-activation’ is not set.</h3><p>This error usually occurred while requesting token, mostly it’s caused by wrong reply URL which iframe could not load it to request token silently. So make sure your reply URL pointing to the blank static HTML resource is right. Additional, this error message is somehow confusing cause it does not tell the root cause directly, check more details <a target="_blank" rel="noopener" href="https://github.com/AzureAD/microsoft-authentication-library-for-js/issues/1199">here</a>.</p>
<h3 id="BrowserAuthError-pcke-not-created-The-PCKE-code-challenge-and-verifier-could-not-be-generated"><a href="#BrowserAuthError-pcke-not-created-The-PCKE-code-challenge-and-verifier-could-not-be-generated" class="headerlink" title="BrowserAuthError: pcke_not_created: The PCKE code challenge and verifier could not be generated."></a>BrowserAuthError: pcke_not_created: The PCKE code challenge and verifier could not be generated.</h3><p>Check the protocol and be sure it’s HTTPS.</p>
<h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ul>
<li><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/azure/active-directory/develop/v2-oauth2-auth-code-flow">Microsoft identity platform and OAuth 2.0 authorization code flow</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/azure/active-directory/develop/v2-overview">What is the Microsoft identity platform?</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/azure/active-directory/fundamentals/auth-oauth2">OAuth 2.0 authentication with Azure Active Directory</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/azure/active-directory/develop/scenario-spa-sign-in">Single-page application: Sign-in and Sign-out</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/azure/active-directory/develop/scenario-spa-acquire-token">Single-page application: Acquire a token to call an API</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/azure/active-directory/develop/msal-client-application-configuration">MSAL Application configuration options</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/azure/active-directory/develop/v2-permissions-and-consent">Permissions and consent in the Microsoft identity platform</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/azure/active-directory/develop/active-directory-configurable-token-lifetimes">Configurable token lifetimes in the Microsoft identity platform</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/azure/active-directory/develop/id-tokens">Microsoft identity platform ID tokens</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/azure/active-directory/develop/access-tokens">Microsoft identity platform access tokens</a></li>
</ul>

    </div>

    
    
    
      


    <footer class="post-footer">
          <div class="reward-container">
  <div>Buy me a cup of coffee :)</div>
  <button onclick="document.querySelector('.post-reward').classList.toggle('active');">
    赞赏
  </button>
  <div class="post-reward">
      <div>
        <img src="/images/reward-wechat.jpg" alt="John Chou 微信">
        <span>微信</span>
      </div>
      <div>
        <img src="/images/reward-alipay.jpg" alt="John Chou 支付宝">
        <span>支付宝</span>
      </div>

  </div>
</div>

          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>本文作者： </strong>John Chou
  </li>
  <li class="post-copyright-link">
      <strong>本文链接：</strong>
      <a href="https://blog.joouis.com/2021/getting-started-with-aad-integration-in-javascript/" title="Getting started with AAD integration in JavaScript">https://blog.joouis.com/2021/getting-started-with-aad-integration-in-javascript/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nd/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-ND</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>

          <div class="post-tags">
              <a href="/tags/oauth/" rel="tag"># oauth</a>
              <a href="/tags/azure/" rel="tag"># azure</a>
              <a href="/tags/aad/" rel="tag"># aad</a>
              <a href="/tags/auth/" rel="tag"># auth</a>
              <a href="/tags/msal/" rel="tag"># msal</a>
              <a href="/tags/microsoft-identity/" rel="tag"># microsoft-identity</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2021/my-first-step-to-jazz/" rel="prev" title="终于，我迈出了爵士人生的第一步">
                  <i class="fa fa-chevron-left"></i> 终于，我迈出了爵士人生的第一步
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2021/3-idiots-while-driving/" rel="next" title="开车有三宝">
                  开车有三宝 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






      
    
  <div class="comments">
    <div id="disqus_thread">
      <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
    </div>
  </div>
  

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      const activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      const commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

    </div>
  </main>

  <footer class="footer">
    <div class="footer-inner">
      

      

<div class="copyright">
  
  &copy; 2016 – 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">John Chou</span>
</div>

    </div>
  </footer>

  
  <script src="//cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/lozad@1.16.0/dist/lozad.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/pangu@4.0.7/dist/browser/pangu.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  
  <script>
    (function(){
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      bp.src = (curProtocol === 'https') ? 'https://zz.bdstatic.com/linksubmit/push.js' : 'http://push.zhanzhang.baidu.com/push.js';
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
    })();
  </script>




  <script src="/js/local-search.js"></script>















  








  

  
  <script src="//cdn.jsdelivr.net/npm/quicklink@2.0.0/dist/quicklink.umd.js"></script>
  <script>
      window.addEventListener('load', () => {
      quicklink.listen({
        timeout : 3000,
        priority: true,
        ignores : [uri => uri.includes('#'),uri => uri === 'https://blog.joouis.com/2021/getting-started-with-aad-integration-in-javascript/',]
      });
      });
  </script>

<script>
  function loadCount() {
    var d = document, s = d.createElement('script');
    s.src = 'https://joou.disqus.com/count.js';
    s.id = 'dsq-count-scr';
    (d.head || d.body).appendChild(s);
  }
  // defer loading until the whole page loading is completed
  window.addEventListener('load', loadCount, false);
</script>
<script>
  var disqus_config = function() {
    this.page.url = "https://blog.joouis.com/2021/getting-started-with-aad-integration-in-javascript/";
    this.page.identifier = "2021/getting-started-with-aad-integration-in-javascript/";
    this.page.title = "Getting started with AAD integration in JavaScript";
    };
  NexT.utils.loadComments('#disqus_thread', () => {
    if (window.DISQUS) {
      DISQUS.reset({
        reload: true,
        config: disqus_config
      });
    } else {
      var d = document, s = d.createElement('script');
      s.src = 'https://joou.disqus.com/embed.js';
      s.setAttribute('data-timestamp', '' + +new Date());
      (d.head || d.body).appendChild(s);
    }
  });
</script>

</body>
</html>
