<!DOCTYPE html>












  


<html class="theme-next mist use-motion" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">




  
  
    
      
    
    
      
    
  <script src="//cdn.jsdelivr.net/npm/pace-js@1/pace.min.js"></script>
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/pace-js@1/themes/blue/pace-theme-minimal.css">















  
  
    
  
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">







  

<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/font-awesome@4/css/font-awesome.min.css">

<link rel="stylesheet" href="/css/main.css?v=7.1.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/hacker.ico?v=7.1.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/hacker.ico?v=7.1.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/hacker.ico?v=7.1.0">


  <link rel="mask-icon" href="/images/hacker.ico?v=7.1.0" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '7.1.0',
    sidebar: {"position":"left","display":"hide","offset":12,"onmobile":true,"dimmer":true},
    back2top: true,
    back2top_sidebar: false,
    fancybox: true,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  

<meta name="baidu-site-verification" content="ChOTP1bKoM">


  <meta name="description" content="è¿™æ˜¯æˆ‘çš„åµŒå…¥å¼ç¬”è®°ç¬¬å››ç¯‡ï¼ŒåŸæ–‡å†™äº2015å¹´ã€‚ å°è±¡ä¸­å›½å†…çš„åµŒå…¥å¼å¼€å‘è¿˜æ˜¯ï¼ˆå¯èƒ½æ˜¯ç›—ç‰ˆçš„ï¼‰IDE åŠ è½½é¡¹ç›®å·¥ç¨‹åä¸€é”®ç¼–è¯‘/çƒ§å½•çš„æ¨¡å¼ï¼Œå¼€å‘äººå‘˜å¯¹åº•å±‚åƒçš„ä¸å¤Ÿé€ï¼Œç¦»å¼€ IDE æˆ–è€…æ¢ä¸ªå¼€å‘ç¯å¢ƒçŠ¹å¦‚æ·±åº¦è¿‘è§†æ‚£è€…ç¦»å¼€äº†çœ¼é•œâ€”â€”å¯¸æ­¥éš¾è¡Œã€‚å†è¯´è¿œä¸€ç‚¹ï¼Œä¼¼ä¹ä¸å°‘äººçš„å­¦ä¹ è·¯å¾„éƒ½æ˜¯é€šè¿‡çœ‹ä¸­æ–‡æ•™æå’Œä¸€äº›åŸ¹è®­ç­è§†é¢‘ï¼ˆæˆ‘å½“å¹´ä¹Ÿçœ‹è¿‡éƒ­å¤©ç¥¥å’ŒéŸ¦ä¸œå±±çš„è§†é¢‘ğŸ˜‚ï¼‰ï¼Œç¼ºä¹â€œä¸€æ‰‹â€çŸ¥è¯†çš„æ‘„å–å’Œä½“ç³»åŒ–çš„è®­ç»ƒã€‚ è¿™ä¸ªå®éªŒé™¤äº†å¯ä»¥æ·±å…¥äº†">
<meta name="keywords" content="embedded system course,embedded system,arm,os,gnu,context switch">
<meta property="og:type" content="article">
<meta property="og:title" content="ä¸Šæ‰‹ä¸€ä¸ªå…·ä½“è€Œå¾®çš„ARMæ“ä½œç³»ç»Ÿ">
<meta property="og:url" content="https://blog.joouis.com/2019/lab-mini-arm-os/index.html">
<meta property="og:site_name" content="æ±Ÿè¾¹çš„æ—±é¸­å­">
<meta property="og:description" content="è¿™æ˜¯æˆ‘çš„åµŒå…¥å¼ç¬”è®°ç¬¬å››ç¯‡ï¼ŒåŸæ–‡å†™äº2015å¹´ã€‚ å°è±¡ä¸­å›½å†…çš„åµŒå…¥å¼å¼€å‘è¿˜æ˜¯ï¼ˆå¯èƒ½æ˜¯ç›—ç‰ˆçš„ï¼‰IDE åŠ è½½é¡¹ç›®å·¥ç¨‹åä¸€é”®ç¼–è¯‘/çƒ§å½•çš„æ¨¡å¼ï¼Œå¼€å‘äººå‘˜å¯¹åº•å±‚åƒçš„ä¸å¤Ÿé€ï¼Œç¦»å¼€ IDE æˆ–è€…æ¢ä¸ªå¼€å‘ç¯å¢ƒçŠ¹å¦‚æ·±åº¦è¿‘è§†æ‚£è€…ç¦»å¼€äº†çœ¼é•œâ€”â€”å¯¸æ­¥éš¾è¡Œã€‚å†è¯´è¿œä¸€ç‚¹ï¼Œä¼¼ä¹ä¸å°‘äººçš„å­¦ä¹ è·¯å¾„éƒ½æ˜¯é€šè¿‡çœ‹ä¸­æ–‡æ•™æå’Œä¸€äº›åŸ¹è®­ç­è§†é¢‘ï¼ˆæˆ‘å½“å¹´ä¹Ÿçœ‹è¿‡éƒ­å¤©ç¥¥å’ŒéŸ¦ä¸œå±±çš„è§†é¢‘ğŸ˜‚ï¼‰ï¼Œç¼ºä¹â€œä¸€æ‰‹â€çŸ¥è¯†çš„æ‘„å–å’Œä½“ç³»åŒ–çš„è®­ç»ƒã€‚ è¿™ä¸ªå®éªŒé™¤äº†å¯ä»¥æ·±å…¥äº†">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="https://jjrgxq.bn.files.1drv.com/y4mJ8PzIgxQl8A49jOlzN8ngCzqii5YaShYpXtm7oZFdUKMwF7GX1ZvPSBRvNfGjuLiBYh1YRzy5m9vWSIjvqP8TZMiALCPL7Y7_JcBbPlnbz9Y5YvrJOa1aR-YJcvnilcffA1dvNXRl0nl6ftucjPS_KPPAJPEC7gc3RGTIADvO3VyL08t_k_QhbIxEsv9M696VtfKDugudAjbONaHfx1rBA?width=665&height=196&cropmode=none">
<meta property="og:image" content="https://jjrexq.bn.files.1drv.com/y4mmQTIAfh9s6wUyEBnPh-M49mtDXgVblanK_JMDZ8AJvYcFVaQpvhGvPxWHAn6pD7_QbqJheIOAgjB1dYOut7kJea25hzUuiyfyK65bBOE1kJCDYyG3gvp_ARYSSckueCeag8T8ATchYqg7vHDg8eMVdoEs-S0rB2TS1p8VyPY-mDSQoxfT0GBxJEJs1LlOGJxjj-7UgZXqk0R55uykuA_ag?width=370&height=118&cropmode=none">
<meta property="og:image" content="https://jjrfxq.bn.files.1drv.com/y4msLq_CmDAujSrfYA8NuEC4ZHMdSokzk4fhPw5YtLQH5vRK5lTnPVFKRcXSDRJ218o_HUpoRvIU16gqEzz0hrYvwbtpAYbDUIw2645rEcIvYlGMMQFSj4K5OxC1tbFuul69ySeIejiKNiKMEa0D9Wk6k7xTN7ORra40ulPvgQP4N32iv3LjrqgG2RdMNLKZ4HRmQ6g3gZ5zMMYNaLagz4OeA?width=836&height=167&cropmode=none">
<meta property="og:image" content="https://jjrdxq.bn.files.1drv.com/y4mRQE5Fump95yZuOzBhNqQ7N5_mzTHEVTypYmPw6OHq2azZPtqvM4q-f1CQdM3kUuGab_l9cDzwEGC-g-wa2M8kUk_WTJOp6PJslaqSky-9HJ5P53vGzibCYaJ1D2_jXAc1eePfITeY4U7wj74WMt84mXkivWuGUX_F-xlWEItxxLJriI_-qID5ZYLFL0nFYYgQT_L1hRr6h2Nc4Mlcp7Wag?width=330&height=182&cropmode=none">
<meta property="og:image" content="https://jjrcxq.bn.files.1drv.com/y4mxOrwfjpJWXVx10ewRnky1wPwqh2R11XAqx-rK7fYKhfnw0_Q74JArry9kVVn4BgN9X-_uc522FXUMVpDK12AMd4YZJsgAQUcUVqHyS46IaGAxRHw-BAwiecYzVgzOaHf2UiuOJ7Tpfs0_N-XTSa7WMGoHru9BdASIGz_T5kmQcuOST6itBFfUUH9IMIbg8uY6Jqo4lWKAnkXSwQfbY6U-Q?width=710&height=457&cropmode=none">
<meta property="og:image" content="https://jjrbxq.bn.files.1drv.com/y4muhuffNAohfnDo-aRDoceuibQPrQEckKbjI4lHjnPFIs9WGd06YSErr1D8mnXD44UqViR2HMQmQ4_wvzsxaCkigz4_EXVvtf8zNBv0r4nCwYj0vwSCu8gaLkmEC28hMXaJ9VXQf0hhqjehXva9wzBL_zppfNl8mBUBl447u-Ml279njbjec48_ELzLOrV7Vcx3spyKlothXlN8JfhBB-NiQ?width=524&height=422&cropmode=none">
<meta property="og:updated_time" content="2019-12-29T14:21:16.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ä¸Šæ‰‹ä¸€ä¸ªå…·ä½“è€Œå¾®çš„ARMæ“ä½œç³»ç»Ÿ">
<meta name="twitter:description" content="è¿™æ˜¯æˆ‘çš„åµŒå…¥å¼ç¬”è®°ç¬¬å››ç¯‡ï¼ŒåŸæ–‡å†™äº2015å¹´ã€‚ å°è±¡ä¸­å›½å†…çš„åµŒå…¥å¼å¼€å‘è¿˜æ˜¯ï¼ˆå¯èƒ½æ˜¯ç›—ç‰ˆçš„ï¼‰IDE åŠ è½½é¡¹ç›®å·¥ç¨‹åä¸€é”®ç¼–è¯‘/çƒ§å½•çš„æ¨¡å¼ï¼Œå¼€å‘äººå‘˜å¯¹åº•å±‚åƒçš„ä¸å¤Ÿé€ï¼Œç¦»å¼€ IDE æˆ–è€…æ¢ä¸ªå¼€å‘ç¯å¢ƒçŠ¹å¦‚æ·±åº¦è¿‘è§†æ‚£è€…ç¦»å¼€äº†çœ¼é•œâ€”â€”å¯¸æ­¥éš¾è¡Œã€‚å†è¯´è¿œä¸€ç‚¹ï¼Œä¼¼ä¹ä¸å°‘äººçš„å­¦ä¹ è·¯å¾„éƒ½æ˜¯é€šè¿‡çœ‹ä¸­æ–‡æ•™æå’Œä¸€äº›åŸ¹è®­ç­è§†é¢‘ï¼ˆæˆ‘å½“å¹´ä¹Ÿçœ‹è¿‡éƒ­å¤©ç¥¥å’ŒéŸ¦ä¸œå±±çš„è§†é¢‘ğŸ˜‚ï¼‰ï¼Œç¼ºä¹â€œä¸€æ‰‹â€çŸ¥è¯†çš„æ‘„å–å’Œä½“ç³»åŒ–çš„è®­ç»ƒã€‚ è¿™ä¸ªå®éªŒé™¤äº†å¯ä»¥æ·±å…¥äº†">
<meta name="twitter:image" content="https://jjrgxq.bn.files.1drv.com/y4mJ8PzIgxQl8A49jOlzN8ngCzqii5YaShYpXtm7oZFdUKMwF7GX1ZvPSBRvNfGjuLiBYh1YRzy5m9vWSIjvqP8TZMiALCPL7Y7_JcBbPlnbz9Y5YvrJOa1aR-YJcvnilcffA1dvNXRl0nl6ftucjPS_KPPAJPEC7gc3RGTIADvO3VyL08t_k_QhbIxEsv9M696VtfKDugudAjbONaHfx1rBA?width=665&height=196&cropmode=none">



  <link rel="alternate" href="/atom.xml" title="æ±Ÿè¾¹çš„æ—±é¸­å­" type="application/atom+xml">



  
  
  <link rel="canonical" href="https://blog.joouis.com/2019/lab-mini-arm-os/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>ä¸Šæ‰‹ä¸€ä¸ªå…·ä½“è€Œå¾®çš„ARMæ“ä½œç³»ç»Ÿ | æ±Ÿè¾¹çš„æ—±é¸­å­</title>
  




  <script async src="//www.googletagmanager.com/gtag/js?id=UA-76188004-1"></script>
  <script>
    var host = window.location.hostname;
    if (host !== "localhost" || !true) {
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-76188004-1');
    }
  </script>



  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?199f195e233fd5ecca0d9346d3259670";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>







  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">æ±Ÿè¾¹çš„æ—±é¸­å­</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <h1 class="site-subtitle" itemprop="description">Blog of Joou</h1>
      
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="åˆ‡æ¢å¯¼èˆªæ ">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    

    

    <a href="/" rel="section">é¦–é¡µ</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    

    

    <a href="/archives/" rel="section">å½’æ¡£</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
    

    

    <a href="/categories/" rel="section">åˆ†ç±»</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-about">

    
    
    

    

    <a href="/about/" rel="section">å…³äº</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-recruit">

    
    
    

    

    <a href="/recruit/" rel="section">æ‹›è˜</a>

  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            æœç´¢</a>
        </li>
      
    </ul>
  

  
    

  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="æœç´¢..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.joouis.com/2019/lab-mini-arm-os/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Chou">
      <meta itemprop="description" content="Stand high, think different.">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="æ±Ÿè¾¹çš„æ—±é¸­å­">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">ä¸Šæ‰‹ä¸€ä¸ªå…·ä½“è€Œå¾®çš„ARMæ“ä½œç³»ç»Ÿ

              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              
                
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2019-12-29 22:21:16" itemprop="dateCreated datePublished" datetime="2019-12-29T22:21:16+08:00">2019-12-29</time>
            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/ç³»ç»Ÿä¸åº•å±‚/" itemprop="url" rel="index"><span itemprop="name">ç³»ç»Ÿä¸åº•å±‚</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          
            <div class="post-symbolscount">
              
                <span class="post-meta-divider">|</span>
              

              

              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
                
                <span title="é˜…è¯»æ—¶é•¿">14 åˆ†é’Ÿ</span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>è¿™æ˜¯æˆ‘çš„<a href="https://blog.joouis.com/2019/watching-notes-revolution-os/">åµŒå…¥å¼ç¬”è®°</a>ç¬¬å››ç¯‡ï¼ŒåŸæ–‡å†™äº2015å¹´ã€‚</p>
<p>å°è±¡ä¸­å›½å†…çš„åµŒå…¥å¼å¼€å‘è¿˜æ˜¯ï¼ˆå¯èƒ½æ˜¯ç›—ç‰ˆçš„ï¼‰IDE åŠ è½½é¡¹ç›®å·¥ç¨‹åä¸€é”®ç¼–è¯‘/çƒ§å½•çš„æ¨¡å¼ï¼Œå¼€å‘äººå‘˜å¯¹åº•å±‚åƒçš„ä¸å¤Ÿé€ï¼Œç¦»å¼€ IDE æˆ–è€…æ¢ä¸ªå¼€å‘ç¯å¢ƒçŠ¹å¦‚æ·±åº¦è¿‘è§†æ‚£è€…ç¦»å¼€äº†çœ¼é•œâ€”â€”å¯¸æ­¥éš¾è¡Œã€‚å†è¯´è¿œä¸€ç‚¹ï¼Œä¼¼ä¹ä¸å°‘äººçš„å­¦ä¹ è·¯å¾„éƒ½æ˜¯é€šè¿‡çœ‹ä¸­æ–‡æ•™æå’Œä¸€äº›åŸ¹è®­ç­è§†é¢‘ï¼ˆæˆ‘å½“å¹´ä¹Ÿçœ‹è¿‡éƒ­å¤©ç¥¥å’ŒéŸ¦ä¸œå±±çš„è§†é¢‘ğŸ˜‚ï¼‰ï¼Œç¼ºä¹â€œä¸€æ‰‹â€çŸ¥è¯†çš„æ‘„å–å’Œä½“ç³»åŒ–çš„è®­ç»ƒã€‚</p>
<p>è¿™ä¸ªå®éªŒé™¤äº†å¯ä»¥æ·±å…¥äº†è§£æ“ä½œç³»ç»Ÿçš„åº•å±‚è¡Œä¸ºå¦‚ä¸Šä¸‹æ–‡åˆ‡æ¢å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªéš¾ç‚¹å°±æ˜¯è¦åœ¨ Linux ç¯å¢ƒä¸‹ä½¿ç”¨ GNU Toolchain ç¼–è¯‘é“¾æ¥ç³»ç»Ÿï¼Œæœ€ç»ˆçƒ§å½•åˆ° ARM ç¡¬ä»¶ä¸Šï¼Œéå¸¸éå¸¸çš„â€œç¡¬æ ¸â€ã€‚</p>
<a id="more"></a>
<h2 id="å‡†å¤‡å·¥ä½œ"><a href="#å‡†å¤‡å·¥ä½œ" class="headerlink" title="å‡†å¤‡å·¥ä½œ"></a>å‡†å¤‡å·¥ä½œ</h2><p>æˆ‘ä»¬ä½¿ç”¨çš„ç¡¬ä»¶æ˜¯æ„æ³•åŠå¯¼ä½“å‡ºçš„ STM32F4 Discovery å¼€å‘æ¿ï¼Œåœ¨å¼€å§‹å®éªŒä¹‹å‰ï¼Œäº†è§£ MCUã€ç”µè·¯å¸ƒå±€ä»¥åŠå¦‚ä½•åœ¨ STM32 MCU ä¸Šå¼€å‘éƒ½æ˜¯å¿…ä¸å¯ç¼ºçš„æ­¥éª¤ï¼Œä¸»è¦å°±æ˜¯é˜…è¯»å¤§é‡èµ„æ–™ã€‚</p>
<ul>
<li><a href="https://docs.google.com/document/d/1Ygl6cEGPXUffhTJE0K6B8zEtGmIuIdCjlZBkFlijUaE/edit" target="_blank" rel="noopener">STM32 ç¨‹å¼é–‹ç™¼ï¼šä»¥ GNU Toolchain ç‚ºä¾‹</a></li>
<li>ld: <a href="http://www.math.utah.edu/docs/info/ld_toc.html#SEC1" target="_blank" rel="noopener">Using ld, The GNU linker</a>, <a href="http://wen00072-blog.logdown.com/posts/246071-study-on-the-linker-script-3" target="_blank" rel="noopener">GNU LD æ‰‹å†Šç•¥è®€ (3): Chapter 3.7 ~ Chapter 3.11</a></li>
<li>STM32: Reference Manual, Datasheet, Schematicsï¼ˆè‡ªè¡ŒæŸ¥é˜…å®˜ç½‘æœ€æ–°ç‰ˆæœ¬ï¼‰</li>
<li>Course: <a href="http://wiki.csie.ncku.edu.tw/embedded/Lab42" target="_blank" rel="noopener">Lab42: Mini ARM OS</a></li>
</ul>
<h2 id="Mini-ARM-OS"><a href="#Mini-ARM-OS" class="headerlink" title="Mini ARM OS"></a><a href="https://github.com/jserv/mini-arm-os" target="_blank" rel="noopener">Mini ARM OS</a></h2><p>GitHub ä»“åº“ç‚¹å‡»æ ‡é¢˜å³å¯è®¿é—®ï¼Œæ²¡æƒ³åˆ°å·²ç»æœ‰ 530 é¢—æ˜Ÿæ˜Ÿäº†ï¼ˆ12/29/2019ï¼‰ï¼ä»¥ä¸‹ç¬”è®°å¯¹åº”å››å¹´å‰çš„ç‰ˆæœ¬ï¼Œå°‘äº†ç¬¬ 7 å’Œç¬¬ 8 è¯¾ï¼Œä»£ç å¯èƒ½ä¹Ÿæœ‰æ‰€æ”¹åŠ¨ï¼Œå‹¿æ€ªã€‚</p>
<h3 id="00-HelloWorld"><a href="#00-HelloWorld" class="headerlink" title="00-HelloWorld"></a>00-HelloWorld</h3><ul>
<li><p>å…ˆmakeç„¶å¾Œmake qemuå¾Œå‡ºç¾hello worldï¼Œç„¶å¾Œè¼¸å…¥arm-none-eabi-objdump -D hello.elfæŸ¥çœ‹executable and linkableæ–‡ä»¶</p>
<p><img src="https://jjrgxq.bn.files.1drv.com/y4mJ8PzIgxQl8A49jOlzN8ngCzqii5YaShYpXtm7oZFdUKMwF7GX1ZvPSBRvNfGjuLiBYh1YRzy5m9vWSIjvqP8TZMiALCPL7Y7_JcBbPlnbz9Y5YvrJOa1aR-YJcvnilcffA1dvNXRl0nl6ftucjPS_KPPAJPEC7gc3RGTIADvO3VyL08t_k_QhbIxEsv9M696VtfKDugudAjbONaHfx1rBA?width=665&amp;height=196&amp;cropmode=none" alt></p>
<p><img src="https://jjrexq.bn.files.1drv.com/y4mmQTIAfh9s6wUyEBnPh-M49mtDXgVblanK_JMDZ8AJvYcFVaQpvhGvPxWHAn6pD7_QbqJheIOAgjB1dYOut7kJea25hzUuiyfyK65bBOE1kJCDYyG3gvp_ARYSSckueCeag8T8ATchYqg7vHDg8eMVdoEs-S0rB2TS1p8VyPY-mDSQoxfT0GBxJEJs1LlOGJxjj-7UgZXqk0R55uykuA_ag?width=370&amp;height=118&amp;cropmode=none" alt></p>
</li>
<li><p>é€™è£å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œåœ¨M3ä¸Šé›»å–å‡ºMSPå¾Œï¼Œæœƒå–å‡ºPCçš„å€¼ï¼Œåœ–ä¸­å¯è¦‹æ˜¯0x000000adã€‚ä½†å¯¦éš›ä¸Šreset_handleråœ°å€æ˜¯å¾000000acé–‹å§‹çš„ã€‚é€™æ˜¯å› çˆ²ï¼š</p>
<p>ç•¶ä¸€å€‹ä¾‹å¤–è™•ç†ç¨‹å¼(exception handler)çš„ä½å€åœ¨LSBè¨­å®šç‚º1ï¼Œä»£è¡¨è©²ä¾‹å¤–è™•ç†ç¨‹å¼é‹ä½œæ–¼Thumbæ¨¡å¼(Thumb mode)ï¼Œå°ARM Cortex-M3ä¾†èªªï¼Œé€™æ˜¯å¿…è¦çš„ï¼Œå› ç‚ºè©²è™•ç†å™¨æ ¸å¿ƒåªæ”¯æ´Thumb-2æŒ‡ä»¤é›†ï¼Œè€Œä¸æ”¯æ´ARMæ¨¡å¼(ä¹Ÿç¨±ARM codeæˆ–ARM state)ã€‚</p>
<p>æ‰€ä»¥<a href="http://wiki.csie.ncku.edu.tw/embedded/Lab42" target="_blank" rel="noopener">http://wiki.csie.ncku.edu.tw/embedded/Lab42</a> çš„æˆªåœ–è£ï¼Œreset_handleræ˜¯å¾0x000000adæ˜¯å¯¦éš›ç·¨è­¯å™¨åœ¨ä¸åŒæ©Ÿå™¨ä¸‹ç·¨è­¯å‡ºä¾†çš„ä¸åŒï¼Ÿ</p>
</li>
<li><p>æ­é…hello.ldå’Œstartup.cä¸€èµ·çœ‹çµ‚æ–¼æœ‰ç¨®æç„¶å¤§æ‚Ÿçš„æ„Ÿè¦ºã€‚.text sectionæœ€å‰é¢çš„ä½ç½®å°±æ˜¯isr_vectorï¼Œç„¶å¾Œå†æ˜¯å…¶ä»–.textæ–‡ä»¶ã€‚ç•¶m3å¾Flashé–‹å§‹è®€å…¥æ•¸æ“šæ™‚ï¼Œé¦–å…ˆå°±æ˜¯isr_vectorçš„å…§å®¹ï¼Œè€Œisr_vectorä¸­é¦–å…ˆçµ¦MSPåœ°å€è³¦0ï¼Œç„¶å¾Œæ˜¯reset_handlerï¼Œè€Œreset_handleræŒ‡å‘Mainå‡½æ•¸ï¼Œé€™æ¨£å°±å°å…¥æˆ‘å€‘å¯«çš„ä¸»å‡½æ•¸äº†</p>
</li>
</ul>
<h3 id="01-HelloWorld"><a href="#01-HelloWorld" class="headerlink" title="01-HelloWorld"></a>01-HelloWorld</h3><ul>
<li><p>æ­¤å¯¦é©—å’Œ00ç›¸æ¯”åœ¨ldä¸Šä½œäº†æ›´å¤šæ–‡ç« ã€‚00-HelloWorldçš„ldæ–‡ä»¶åƒ…é…ç½®äº†Flashå’Œ.text sectionï¼Œè€Œ01ä¸­å‰‡å¤šé…ç½®äº†RAMï¼Œå°‡é‹è¡Œæ™‚ä¸æœƒæ›´æ”¹çš„.textã€.rodataã€æ”¾å…¥.text sectionä¸­ï¼Œ.dataæ”¾å…¥.data sectionä¸­</p>
</li>
<li><p>ATçš„_sidataè¡¨ç¤ºäº†.dataè¼‰å…¥RAMå¾Œçš„LMAã€‚å› çˆ²data sectionæœƒå¾flashæ¬ç§»åˆ°SRAMä¸­ï¼Œå› æ­¤å®ƒçš„LMAå’ŒVMAæœƒä¸åŒã€‚é€£çµå™¨è…³æœ¬çš„ä¸€å€‹é‡è¦ä½œç”¨ï¼Œå°±æ˜¯ç®¡ç†å€‹åˆ¥sectionçš„LMAå’ŒVMAï¼Œä¸¦åœ¨å¿…è¦çš„æƒ…æ³ä¸‹ï¼ŒæŠŠæœ‰é—œè³‡è¨Šæä¾›çµ¦ç¨‹å¼ç¨‹å¼ç¢¼ä½¿ç”¨ã€‚</p>
</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Copy the data segment initializers from flash to SRAM */</span></span><br><span class="line"><span class="keyword">uint32_t</span> *idata_begin = &amp;_sidata;</span><br><span class="line"><span class="keyword">uint32_t</span> *data_begin = &amp;_sdata;</span><br><span class="line"><span class="keyword">uint32_t</span> *data_end = &amp;_edata;</span><br><span class="line"><span class="keyword">while</span> (data_begin &lt; data_end) *data_begin++ = *idata_begin++;</span><br></pre></td></tr></table></figure>
<h3 id="02-ContextSwitch-1"><a href="#02-ContextSwitch-1" class="headerlink" title="02-ContextSwitch-1"></a>02-ContextSwitch-1</h3><ul>
<li>åœ¨startup.cä¸­å®šç¾©äº†nmi_handlerå’Œhardfault_handlerï¼Œåœ°å€åœ¨reset_handlerä¹‹å¾Œï¼Œä»€éº¼æ™‚å€™æœƒè§¸ç™¼ä»–å€‘å‘¢ï¼Ÿ</li>
<li>mspçš„å€¼çˆ²_estack=RAMçš„åˆå§‹ä½ç½®åŠ ä¸ŠRAMçš„å¯¬åº¦ï¼Œå³0x20000000+40kï¼Œé€™æ¨£æ„å‘³é€™stackçš„çˆ²40Kå¤§å°ï¼Œé€™å€‹å¤§å°çš„stackæ„Ÿè¦ºè¶³å¤ å¯¬è£•ï¼</li>
<li>æ¥ç€çœ‹os.cè£çš„mainå‡½æ•¸<ul>
<li>cortex-mç³»åˆ—è™•ç†å™¨<a href="http://infocenter.arm.com/help/index.jsp?topic=/com.arm.doc.dui0552a/CHDBIBGJ.html" target="_blank" rel="noopener">core registers</a></li>
<li>é¦–å…ˆå®šç¾©é¡usertaskçš„å †æ£§å¤§å°256<em>4byte=1kï¼Œç„¶å¾Œå®šç¾©ä¸€å€‹æŒ‡é‡\</em>usertask_stack_startæŒ‡å‘usertaskå †æ£§åŠ 256-16çš„è·é›¢ï¼Œè€Œusertaskçš„åœ°å€å¾usertask_stack_startæ£§åº•-8æ‰é–‹å§‹ï¼Œé€™ä¸­é–“å¤šå‡ºäº†24byteã€‚æˆ‘æƒ³é€™æ‡‰è©²æ˜¯call stackçš„æ¦‚å¿µï¼Œçˆ²äº†å¾Œé–€èª¿ç”¨usertaskå‡½æ•¸çš„argumentã€return addressã€saved ebp%ç­‰ç•™ä¸‹ç©ºé–“(24byteæ‡‰è©²æ˜¯6å€‹ç©ºæ ¼)</li>
</ul>
</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">/* Initialization of process stack.</span></span><br><span class="line"><span class="comment">     * r4, r5, r6, r7, r8, r9, r10, r11, lr</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> usertask_stack[<span class="number">256</span>];</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> *usertask_stack_start = usertask_stack + <span class="number">256</span> - <span class="number">16</span>;</span><br><span class="line">    usertask_stack_start[<span class="number">8</span>] = (<span class="keyword">unsigned</span> <span class="keyword">int</span>) &amp;usertask;</span><br><span class="line"></span><br><span class="line">    usart_init();</span><br><span class="line"></span><br><span class="line">    print_str(<span class="string">"OS Starting...\n"</span>);</span><br><span class="line">    activate(usertask_stack_start);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// while (1); /* We can't exit, there is nowhere to go */</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>contex_swtich.sä¸­.syntax unifiedï¼šCortex-m3çˆ²äº†å…¼å®¹thumbæŒ‡ä»¤å’Œthumb2æŒ‡ä»¤ï¼Œä½¿é€™å…©ç¨®æŒ‡ä»¤å¯ä»¥ä½¿ç”¨çµ±ä¸€çš„æ ¼å¼ï¼Œå¼•å…¥äº†ä¸€ç¨®å«åšâ€œUALâ€çš„èªæ³•æ©Ÿåˆ¶ã€‚ç°¡å–®èªªä¾†å°±æ˜¯ç¨‹åºå“¡ä¸ç”¨é—œå¿ƒè‡ªå·±ä½¿ç”¨çš„æ˜¯thumbé‚„æ˜¯thumb2æŒ‡ä»¤ï¼Œè€Œæ˜¯çµ±ä¸€ä½¿ç”¨32ä½thumb2æŒ‡ä»¤çš„èªæ³•æ ¼å¼æ›¸å¯«ã€‚å…·é«”çš„æ©Ÿå™¨æŒ‡ä»¤æ˜¯16ä½é‚„æ˜¯32ä½ç”±ç·¨è­¯å™¨ä¾†æ±ºå®šã€‚.syntax unifiedçš„ä½œç”¨å°±æ˜¯åˆ¶å®šä½¿ç”¨é€™ä¸€åŠŸèƒ½ï¼Œå…·é«”å¯ä»¥åƒè€ƒã€Šcortex-m3æ¬Šå¨æŒ‡å—ã€‹ã€‚</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">/* save kernel state */</span><br><span class="line">mrs ip, psr</span><br><span class="line">push &#123;r4, r5, r6, r7, r8, r9, r10, r11, ip, lr&#125;</span><br><span class="line">/* switch to process stack */</span><br><span class="line">msr psp, r0</span><br><span class="line">mov r0, #3</span><br><span class="line">msr control, r0</span><br><span class="line">/* load user state */</span><br><span class="line">pop &#123;r4, r5, r6, r7, r8, r9, r10, r11, lr&#125;</span><br><span class="line">/* jump to user task */</span><br><span class="line">bx lr</span><br></pre></td></tr></table></figure>
<ul>
<li><p>æ¥ç€é€™æ®µä»£ç¢¼ï¼š</p>
<ul>
<li><p>MRSï¼šMove to ARM register from system coprocessor register. MRS <em>Rn</em>, <em>coproc_register</em>ä¸­Rn is the ARM destination register, and R<em>n</em> must not be PC. System coprocessor registeræ‡‰è©²æ˜¯é‚£äº›special registersï¼Œå…¶ä¸­åŒ…å«psr(Program status register)ã€‚MSRåä¹‹ã€‚</p>
</li>
<li><p>å°‡mainå‡½æ•¸(kernel)çš„ç‹€æ…‹å­˜å…¥å †æ£§å¾Œï¼Œå°‡r0æ•¸æ“šå­˜å…¥ç¨‹åºç‹€æ…‹å¯„å­˜å™¨(æ­¤æ™‚r0æ‡‰è©²å­˜æ”¾äº†usertask_stack_startåœ°å€)ï¼Œç„¶å¾Œè¨­å®š<a href="http://infocenter.arm.com/help/index.jsp?topic=/com.arm.doc.dui0552a/CHDBIBGJ.html" target="_blank" rel="noopener">controlå¯„å­˜å™¨</a>çˆ²0b11ã€‚æ‰€ä»¥ç¾åœ¨stack pointeræ˜¯PSPï¼Œè€ŒPSPä¸­å­˜æ”¾çš„æ˜¯usertask_stack_startåœ°å€ï¼Œè‡³æ–¼Thread modeæ˜¯Unprivilegedã€‚</p>
<p><img src="https://jjrfxq.bn.files.1drv.com/y4msLq_CmDAujSrfYA8NuEC4ZHMdSokzk4fhPw5YtLQH5vRK5lTnPVFKRcXSDRJ218o_HUpoRvIU16gqEzz0hrYvwbtpAYbDUIw2645rEcIvYlGMMQFSj4K5OxC1tbFuul69ySeIejiKNiKMEa0D9Wk6k7xTN7ORra40ulPvgQP4N32iv3LjrqgG2RdMNLKZ4HRmQ6g3gZ5zMMYNaLagz4OeA?width=836&amp;height=167&amp;cropmode=none" alt></p>
</li>
<li><p>æœ€å¾ŒæŠŠusertask_stackä¸­çš„å¯„å­˜å™¨å€¼æ‹¿å‡ºä¾†ï¼Œå°±å¯ä»¥è·³è½‰åˆ°user stateäº†</p>
</li>
<li><p>æ­¤å¤„è¡¥å……ä¸¤ç¯‡ ARM å®˜æ–¹æ–‡æ¡£ï¼š<a href="http://infocenter.arm.com/help/index.jsp?topic=/com.arm.doc.dai0179b/ar01s02s06.html" target="_blank" rel="noopener">2.6. Execution Modes</a>, <a href="http://infocenter.arm.com/help/index.jsp?topic=/com.arm.doc.dui0552a/CHDIGFCA.html" target="_blank" rel="noopener">2.1.1. Processor mode and privilege levels for software execution</a></p>
</li>
</ul>
</li>
</ul>
<h3 id="03-ContextSwitch-2"><a href="#03-ContextSwitch-2" class="headerlink" title="03-ContextSwitch-2"></a>03-ContextSwitch-2</h3><ul>
<li>startup.cä¸­å¤šäº†ä¸€äº›è²æ˜ï¼š</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">nmi_handler</span><span class="params">(<span class="keyword">void</span>)</span> __<span class="title">attribute</span><span class="params">((weak, alias(<span class="string">"default_handler"</span>)))</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">hardfault_handler</span><span class="params">(<span class="keyword">void</span>)</span> __<span class="title">attribute</span><span class="params">((weak, alias(<span class="string">"default_handler"</span>)))</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">memmanage_handler</span><span class="params">(<span class="keyword">void</span>)</span> __<span class="title">attribute</span><span class="params">((weak, alias(<span class="string">"default_handler"</span>)))</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">busfault_handler</span><span class="params">(<span class="keyword">void</span>)</span> __<span class="title">attribute</span><span class="params">((weak, alias(<span class="string">"default_handler"</span>)))</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">usagefault_handler</span><span class="params">(<span class="keyword">void</span>)</span> __<span class="title">attribute</span><span class="params">((weak, alias(<span class="string">"default_handler"</span>)))</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">svc_handler</span><span class="params">(<span class="keyword">void</span>)</span> __<span class="title">attribute</span><span class="params">((weak, alias(<span class="string">"default_handler"</span>)))</span></span>;</span><br></pre></td></tr></table></figure>
<ul>
<li>alias (â€œtargetâ€): The alias attribute causes the declaration to be emitted as an alias for another symbol, which must be specified.</li>
<li>æ‰€ä»¥*_handlerå…¨éƒ¨aliasåˆ°äº†default_handlerä¸Šï¼Œè€Œdefault_handlerç›®å‰çˆ²ä¸€å€‹æ­»å¾ªç’°ï¼š</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">default_handler</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>syscallçš„å®šç¾©ï¼Œé—œæ–¼ <code>svc 0</code> é€™å€‹<a href="https://reverseengineering.stackexchange.com/questions/4217/arm-shellcode-for-linux-svc-0-vs-svc-1" target="_blank" rel="noopener">å›ç­”</a>å¾ˆå¥½</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">syscall:</span><br><span class="line">    svc 0</span><br><span class="line">    nop</span><br><span class="line">    bx lr</span><br></pre></td></tr></table></figure>
<ul>
<li>åœ¨context_switch.Sä¸­å®šç¾©äº†svc_handlerå‡½æ•¸ï¼Œè¯æƒ³åˆ°startup.cä¸­çš„weak aliasï¼Œå¯ä»¥ç†è§£weak aliasçš„æ„æ€å°±æ˜¯ç·¨è­¯å™¨å‡å¦‚åœ¨æ–‡ä»¶ä¸­æ‰¾åˆ°äº†æŸå€‹å‡½æ•¸çš„å®šç¾©å°±æœƒç·¨è­¯ï¼Œå‡å¦‚æ²’æœ‰æ‰¾åˆ°å°±æœƒå°‡å…¶aliasåˆ°æŒ‡å®šçš„weak aliaså‡½æ•¸ã€‚<ul>
<li>é—œæ–¼<a href="http://infocenter.arm.com/help/index.jsp?topic=/com.arm.doc.dui0552a/BABCAEDD.html" target="_blank" rel="noopener">stmdb</a>ï¼Œstmä»£è¡¨å­˜å„²æ›´å¤šå¯„å­˜å™¨ï¼Œdbä»£è¡¨åœ¨ç²å–å‰å°‡åœ°å€æ¸›å°ã€‚æ‰€ä»¥å°±æ˜¯r0åœ°å€æœƒå¢åŠ 9*4bytesï¼Œç„¶å¾Œå°‡{}ä¸­çš„9å€‹å¯„å­˜å™¨å¾å·¦è‡³å³å¾æœ€ä½ä½ç½®é–‹å§‹å­˜æ”¾</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">svc_handler:</span><br><span class="line">	/* save user state */</span><br><span class="line">    mrs r0, psp</span><br><span class="line">    stmdb r0!, &#123;r4, r5, r6, r7, r8, r9, r10, r11, lr&#125;</span><br><span class="line"></span><br><span class="line">    /* load kernel state */</span><br><span class="line">    pop &#123;r4, r5, r6, r7, r8, r9, r10, r11, ip, lr&#125;</span><br><span class="line">    msr psr, ip</span><br><span class="line"></span><br><span class="line">    bx lr</span><br></pre></td></tr></table></figure>
<p><img src="https://jjrdxq.bn.files.1drv.com/y4mRQE5Fump95yZuOzBhNqQ7N5_mzTHEVTypYmPw6OHq2azZPtqvM4q-f1CQdM3kUuGab_l9cDzwEGC-g-wa2M8kUk_WTJOp6PJslaqSky-9HJ5P53vGzibCYaJ1D2_jXAc1eePfITeY4U7wj74WMt84mXkivWuGUX_F-xlWEItxxLJriI_-qID5ZYLFL0nFYYgQT_L1hRr6h2Nc4Mlcp7Wag?width=330&amp;height=182&amp;cropmode=none" alt></p>
<ul>
<li>ç¨‹åºrunå¯è¦‹ç•¶usertaskè§¸ç™¼syscallå¾Œæœƒä¿å­˜å…¶ç‹€æ…‹ï¼Œç„¶å¾Œåˆ‡å›mainå‡½æ•¸è¼¸å‡ºå…©å€‹print_strï¼Œç„¶å¾Œå›åˆ°usertaskå¾Œæœƒç¹¼çºŒæ¥ç€ä¸Šä¸€æ¬¡çš„åŸ·è¡Œåˆ°çš„åœ°æ–¹ç¹¼çºŒåŸ·è¡Œï¼Œå†è¼¸å‡ºå…©å¥è©±ï¼Œç„¶å¾Œå›åˆ°mainå‡½æ•¸ï¼Œä¹Ÿæ˜¯æ¥ç€ä¸Šæ¬¡åŸ·è¡Œå¾Œçš„åœ°æ–¹ç¹¼çºŒåŸ·è¡Œã€‚é€™é©—è­‰äº†ä¹‹å‰ä»£ç¢¼è£é—œæ–¼user stateå’Œkernel stateçš„saveå’Œloadå‹•ä½œã€‚</li>
</ul>
<h3 id="04-Multitasking"><a href="#04-Multitasking" class="headerlink" title="04-Multitasking"></a>04-Multitasking</h3><p><img src="https://jjrcxq.bn.files.1drv.com/y4mxOrwfjpJWXVx10ewRnky1wPwqh2R11XAqx-rK7fYKhfnw0_Q74JArry9kVVn4BgN9X-_uc522FXUMVpDK12AMd4YZJsgAQUcUVqHyS46IaGAxRHw-BAwiecYzVgzOaHf2UiuOJ7Tpfs0_N-XTSa7WMGoHru9BdASIGz_T5kmQcuOST6itBFfUUH9IMIbg8uY6Jqo4lWKAnkXSwQfbY6U-Q?width=710&amp;height=457&amp;cropmode=none" alt></p>
<ul>
<li><p>diff context_switch.S ../03-ContextSwitch-2/context_switch.S ï¼Œç™¼ç¾ï¼š</p>
<ul>
<li>svc_handlerä¸­çš„msr psr, ipè®Šæˆäº†msr psr_nzcvq, ipï¼Œ<a href="http://infocenter.arm.com/help/topic/com.arm.doc.qrc0001mc/QRC0001_UAL.pdf" target="_blank" rel="noopener">nzcv</a>çˆ²psrçš„å››å€‹æ¨™èªŒä½</li>
</ul>
</li>
<li><p>å¦å¤–åœ¨activateä¸­ï¼Œåœ¨åˆ‡æ›åˆ°process staskå¾Œå¤šä¸€æ¢isbæŒ‡ä»¤ï¼š</p>
<p>Instruction Synchronization Barrier flushes the pipeline in the processor, so that all instructions following the ISB are fetched from cache or memory, after the instruction has been completed. It ensures that the effects of context altering operations, such as changing the ASID, or completed TLB maintenance operations, or branch predictor maintenance operations, as well as all changes to the CP15 registers, executed before the ISB instruction are visible to the instructions fetched after the ISB.<br>In addition, the ISB instruction ensures that any branches that appear in program order after it are always written into the branch prediction logic with the context that is visible after the ISB instruction. This is required to ensure correct execution of the instruction stream.</p>
</li>
<li><p>é‡é ­æˆ²åœ¨os.cï¼Œé¦–å…ˆå®å®šç¾©äº†ä¸‰å€‹åœ°å€ï¼š</p>
</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> HANDLER_MSP 0xFFFFFFF1</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> THREAD_MSP  0xFFFFFFF9</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> THREAD_PSP  0xFFFFFFFD</span></span><br></pre></td></tr></table></figure>
<p><img src="https://jjrbxq.bn.files.1drv.com/y4muhuffNAohfnDo-aRDoceuibQPrQEckKbjI4lHjnPFIs9WGd06YSErr1D8mnXD44UqViR2HMQmQ4_wvzsxaCkigz4_EXVvtf8zNBv0r4nCwYj0vwSCu8gaLkmEC28hMXaJ9VXQf0hhqjehXva9wzBL_zppfNl8mBUBl447u-Ml279njbjec48_ELzLOrV7Vcx3spyKlothXlN8JfhBB-NiQ?width=524&amp;height=422&amp;cropmode=none" alt></p>
<ul>
<li>æ¥ç€æ–°å»ºä¸€å€‹taskï¼š</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">unsigned</span> <span class="keyword">int</span> *<span class="title">create_task</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">int</span> *<span class="built_in">stack</span>, <span class="keyword">void</span> (*start)(<span class="keyword">void</span>))</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">int</span> first = <span class="number">1</span>;</span><br><span class="line">        <span class="built_in">stack</span> += STACK_SIZE - <span class="number">32</span>; <span class="comment">/* End of stack, minus what we are about to push */</span></span><br><span class="line">        <span class="keyword">if</span> (first) &#123;</span><br><span class="line">                <span class="built_in">stack</span>[<span class="number">8</span>] = (<span class="keyword">unsigned</span> <span class="keyword">int</span>) start;</span><br><span class="line">                first = <span class="number">0</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="built_in">stack</span>[<span class="number">8</span>] = (<span class="keyword">unsigned</span> <span class="keyword">int</span>) THREAD_PSP;</span><br><span class="line">                <span class="built_in">stack</span>[<span class="number">15</span>] = (<span class="keyword">unsigned</span> <span class="keyword">int</span>) start;</span><br><span class="line">                <span class="built_in">stack</span>[<span class="number">16</span>] = (<span class="keyword">unsigned</span> <span class="keyword">int</span>) <span class="number">0x01000000</span>; <span class="comment">/* PSR Thumb bit */</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">stack</span> = activate(<span class="built_in">stack</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">stack</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è€Œåœ¨mainå‡½æ•¸ä¸­ï¼Œå°æ‡‰çš„èª¿ç”¨æ˜¯ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å®šç¾©äº†ç¨‹å¼stackçš„æ•¸é‡(2å€‹)å’Œå¤§å°(256*4bytes)</span></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> user_stacks[TASK_LIMIT][STACK_SIZE];</span><br><span class="line"><span class="comment">//å®šç¾©äº†ç”¨æˆ¶ç¨‹å¼çš„æ•¸é‡(2å€‹)</span></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> *usertasks[TASK_LIMIT];</span><br><span class="line"><span class="comment">//å°‡ä¹‹å‰å®šç¾©çš„stackå’Œfunctionåœ°å€å‚³çµ¦create_taské…ç½®</span></span><br><span class="line">usertasks[<span class="number">0</span>]=create_task(user_stack[<span class="number">0</span>],&amp;task_func);</span><br></pre></td></tr></table></figure>
<ul>
<li>ç•¶ä½¿ç”¨create_taskå‡½æ•¸ç¬¬ä¸€æ¬¡é€²è¡Œåˆå§‹åŒ–æ™‚ï¼Œåœ¨create_taskä¸­å°taskçš„stacké€²è¡Œäº†é…ç½®ï¼Œä¸¦ä¸”å› çˆ²æ˜¯ç¬¬ä¸€æ¬¡è¨­å®šï¼Œå°‡stack[8]å­˜æ”¾äº†task_funcçš„åœ°å€ï¼Œç„¶å¾Œé€²å…¥åˆ°task_funcä¸­echoâ€task1 Createdâ€&amp;â€returnâ€å¾Œèª¿ç”¨syscallå›åˆ°äº†mainå‡½æ•¸ã€‚</li>
<li>ç•¶ç¬¬äºŒæ¬¡å‘¼å«create_taskæ™‚ï¼Œcommentä¹Ÿæœ‰èªªæ˜ï¼Œå› çˆ²activateæ˜¯å¾exceptionä¸­è¿”å›ï¼Œæ•…å°‡lrä¿å­˜çˆ²THREAD_PSPï¼Œè€Œæ­¤æ™‚çš„funcå¾stack[15]é–‹å§‹</li>
<li>çˆ²ä½•ç·Šæ¥ç€çš„stack[16]å°±è¦è¨­epsrçˆ²0x01000000ï¼Ÿçˆ²ä½•processorå¯ä»¥èªå‡ºé€™æ¢æŒ‡ä»¤æ˜¯è¨­ç½®esprçš„ï¼Ÿ<ul>
<li>The following can clear the T bit to 0: (1)instructionsBLX, BX and POP{PC} (2)restoration from the stacked xPSR value on an exception return (3)bit[0] of the vector value on an exception entry or reset. æ‰€ä»¥éœ€è¦å†å°‡epsrè¨­çˆ²thumb stateã€‚</li>
</ul>
</li>
</ul>
<h3 id="05-TimerInterrupt"><a href="#05-TimerInterrupt" class="headerlink" title="05-TimerInterrupt"></a>05-TimerInterrupt</h3><ul>
<li><p>é¦–å…ˆçœ‹å•“å‹•æ–‡ä»¶ï¼Œå¤šäº†pendsvå’Œsystickçš„å®šç¾©ï¼Œé—œæ–¼<a href="http://infocenter.arm.com/help/index.jsp?topic=/com.arm.doc.dui0553a/BABBGBEC.html" target="_blank" rel="noopener">Cortex-M3è¨­å‚™çš„ç•°å¸¸é¡å‹</a>å†è¤‡ç¿’ä¸€ä¸‹</p>
</li>
<li><p>void __attribute__((interrupt)) systick_handler(void)</p>
<ul>
<li>The compiler generates function entry and exit sequences suitable for use in an interrupt handler when this attribute is present. With Epiphany targets it may also generate a special section with code to initialize the interrupt vector table.(<a href="https://gcc.gnu.org/onlinedocs/gcc/Function-Attributes.html" target="_blank" rel="noopener">https://gcc.gnu.org/onlinedocs/gcc/Function-Attributes.html</a>)</li>
</ul>
</li>
</ul>
<h3 id="06-Preemptive"><a href="#06-Preemptive" class="headerlink" title="06-Preemptive"></a>06-Preemptive</h3><ul>
<li>åœ¨context_switch.sä¸­å°systick_handlerå®šç¾©äº†ä¸€æ¨£çš„è¡Œçˆ²ï¼Œç•¶systick exceptionè§¸ç™¼æ™‚ï¼Œä¹Ÿæœƒå°‡é€²ç¨‹åˆ‡æ›åˆ°kernel modeã€‚</li>
<li>ä¸€ç›´æ²’æ‰¾åˆ°delay()å’Œsystickæœ‰ä»€éº¼ç›´æ¥è¯ç¹«ï¼Œæç„¶å¤§æ‚Ÿï¼šç•¶ä¸€å€‹taskåœ¨é‹è¡Œæ™‚ï¼Œç”±æ–¼ç™¼ç”Ÿäº†systick exceptionï¼Œå°±æœƒåˆ‡æ›åˆ°kernel modeç„¶å¾Œé‹è¡Œä¸‹ä¸€å€‹taskï¼Œé€™æ¨£å°±å¦‚åŒpreemptiveã€‚</li>
</ul>

      
    </div>

    
      

  <div class="popular-posts-header">ç›¸å…³æ–‡ç« </div>
  <ul class="popular-posts">
  
    <li class="popular-posts-item">
      
      
      <div class="popular-posts-title"><a href="/2019/am335x-arm-cortex-a8-boot-sequence/" rel="bookmark">è§£æAM335x Arm Cortex-A8å¤„ç†å™¨çš„å¯åŠ¨æµç¨‹</a></div>
      
    </li>
  
    <li class="popular-posts-item">
      
      
      <div class="popular-posts-title"><a href="/2020/lab-compiler-intro/" rel="bookmark">ç¼–è¯‘å™¨å…¥é—¨å°ç¬”è®°</a></div>
      
    </li>
  
    <li class="popular-posts-item">
      
      
      <div class="popular-posts-title"><a href="/2019/watching-notes-revolution-os/" rel="bookmark">è§‚å½±ç®€è®°ï¼šã€ŠRevolution OSï¼ˆæ“ä½œç³»ç»Ÿé©å‘½ï¼‰ã€‹</a></div>
      
    </li>
  
    <li class="popular-posts-item">
      
      
      <div class="popular-posts-title"><a href="/2020/lab-leetcode-practices/" rel="bookmark">LeetCodeå°ç»ƒä¹ </a></div>
      
    </li>
  
    <li class="popular-posts-item">
      
      
      <div class="popular-posts-title"><a href="/2020/lab-prefetch-intro/" rel="bookmark">Prefetcherå°ç»ƒä¹ </a></div>
      
    </li>
  
  </ul>


    

    
    
    

    

    
      
    
    
      <div>
        <div id="reward-container">
  <div>Buy me a cup of coffee :)</div>
  <button id="reward-button" disable="enable" onclick="var qr = document.getElementById(&quot;qr&quot;); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">
    æ‰“èµ
  </button>
  <div id="qr" style="display: none;">

    
      
      
        
      
      <div style="display: inline-block">
        <img src="/images/reward-wechat.jpg" alt="John Chou å¾®ä¿¡æ”¯ä»˜">
        <p>å¾®ä¿¡æ”¯ä»˜</p>
      </div>
    
      
      
        
      
      <div style="display: inline-block">
        <img src="/images/reward-alipay.jpg" alt="John Chou æ”¯ä»˜å®">
        <p>æ”¯ä»˜å®</p>
      </div>
    

  </div>
</div>

      </div>
    

    
      <div>
        




  



<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>æœ¬æ–‡ä½œè€…ï¼š </strong>John Chou</li>
  <li class="post-copyright-link">
    <strong>æœ¬æ–‡é“¾æ¥ï¼š</strong>
    
    <a href="https://blog.joouis.com/2019/lab-mini-arm-os/" title="ä¸Šæ‰‹ä¸€ä¸ªå…·ä½“è€Œå¾®çš„ARMæ“ä½œç³»ç»Ÿ">https://blog.joouis.com/2019/lab-mini-arm-os/</a>
  </li>
  <li class="post-copyright-license">
    <strong>ç‰ˆæƒå£°æ˜ï¼š </strong>æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nd/4.0/" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i>BY-ND</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼</li>
</ul>

      </div>
    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/embedded-system-course/" rel="tag"># embedded system course</a>
          
            <a href="/tags/embedded-system/" rel="tag"># embedded system</a>
          
            <a href="/tags/arm/" rel="tag"># arm</a>
          
            <a href="/tags/os/" rel="tag"># os</a>
          
            <a href="/tags/gnu/" rel="tag"># gnu</a>
          
            <a href="/tags/context-switch/" rel="tag"># context switch</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/am335x-arm-cortex-a8-boot-sequence/" rel="next" title="è§£æAM335x Arm Cortex-A8å¤„ç†å™¨çš„å¯åŠ¨æµç¨‹">
                <i class="fa fa-chevron-left"></i> è§£æAM335x Arm Cortex-A8å¤„ç†å™¨çš„å¯åŠ¨æµç¨‹
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2020/lab-compiler-intro/" rel="prev" title="ç¼–è¯‘å™¨å…¥é—¨å°ç¬”è®°">
                ç¼–è¯‘å™¨å…¥é—¨å°ç¬”è®° <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  
    <div class="comments" id="comments">
      <div id="disqus_thread">
        <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
      </div>
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            æ–‡ç« ç›®å½•
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            ç«™ç‚¹æ¦‚è§ˆ
          </li>
        </ul>
      

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/avatar.jpg" alt="John Chou">
            
              <p class="site-author-name" itemprop="name">John Chou</p>
              <div class="site-description motion-element" itemprop="description">Stand high, think different.</div>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">50</span>
                    <span class="site-state-item-name">æ—¥å¿—</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  
                    
                      <a href="/categories/">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">7</span>
                    <span class="site-state-item-name">åˆ†ç±»</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  
                    
                      <a href="/tags/">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">179</span>
                    <span class="site-state-item-name">æ ‡ç­¾</span>
                  </a>
                </div>
              
            </nav>
          

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  
                  
                  
                    
                  
                  <a href="https://github.com/Joouis" title="GitHub &rarr; https://github.com/Joouis" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i></a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                  
                    
                  
                  <a href="mailto:luckyjoou@gmail.com" title="E-Mail &rarr; mailto:luckyjoou@gmail.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i></a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                  
                    
                  
                  <a href="https://www.instagram.com/Joouis" title="Instagram &rarr; https://www.instagram.com/Joouis" rel="noopener" target="_blank"><i class="fa fa-fw fa-instagram"></i></a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                  
                    
                  
                  <a href="http://www.slideshare.net/choujohn351" title="SlideShare &rarr; http://www.slideshare.net/choujohn351" rel="noopener" target="_blank"><i class="fa fa-fw fa-slideshare"></i></a>
                </span>
              
            </div>
          

          
             <div class="cc-license motion-element" itemprop="license">
              
              
                
              
              
              
              <a href="https://creativecommons.org/licenses/by-nd/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nd.svg" alt="Creative Commons"></a>
             </div>
          

          
          

          
            
          
          

        </div>
      </div>

      
      <!--noindex-->
        <div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
            
            
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#å‡†å¤‡å·¥ä½œ"><span class="nav-number">1.</span> <span class="nav-text">å‡†å¤‡å·¥ä½œ</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Mini-ARM-OS"><span class="nav-number">2.</span> <span class="nav-text">Mini ARM OS</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#00-HelloWorld"><span class="nav-number">2.1.</span> <span class="nav-text">00-HelloWorld</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#01-HelloWorld"><span class="nav-number">2.2.</span> <span class="nav-text">01-HelloWorld</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#02-ContextSwitch-1"><span class="nav-number">2.3.</span> <span class="nav-text">02-ContextSwitch-1</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#03-ContextSwitch-2"><span class="nav-number">2.4.</span> <span class="nav-text">03-ContextSwitch-2</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#04-Multitasking"><span class="nav-number">2.5.</span> <span class="nav-text">04-Multitasking</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#05-TimerInterrupt"><span class="nav-number">2.6.</span> <span class="nav-text">05-TimerInterrupt</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#06-Preemptive"><span class="nav-number">2.7.</span> <span class="nav-text">06-Preemptive</span></a></li></ol></li></ol></div>
            

          </div>
        </div>
      <!--/noindex-->
      

      

    </div>
  </aside>
  
    <div id="sidebar-dimmer"></div>
  


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2016 â€“ <span itemprop="copyrightYear">2020</span>
  <span class="with-love" id="animate">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">John Chou</span>

  

  
</div>









        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>












  















  
  <script src="//cdn.jsdelivr.net/npm/jquery@2/dist/jquery.min.js"></script>

  
  <script src="//cdn.jsdelivr.net/npm/velocity-animate@1/velocity.min.js"></script>

  
  <script src="//cdn.jsdelivr.net/npm/velocity-animate@1/velocity.ui.min.js"></script>

  
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>


  


  <script src="/js/utils.js?v=7.1.0"></script>

  <script src="/js/motion.js?v=7.1.0"></script>



  
  


  <script src="/js/schemes/muse.js?v=7.1.0"></script>




  
  <script src="/js/scrollspy.js?v=7.1.0"></script>
<script src="/js/post-details.js?v=7.1.0"></script>



  


  <script src="/js/next-boot.js?v=7.1.0"></script>


  
  <script src="/js/js.cookie.js?v=7.1.0"></script>
  <script src="/js/scroll-cookie.js?v=7.1.0"></script>


  

  
  
  
    
  

  

  
  
  


  
  

<script>
  var disqus_config = function() {
    this.page.url = "https://blog.joouis.com/2019/lab-mini-arm-os/";
    this.page.identifier = "2019/lab-mini-arm-os/";
    this.page.title = 'ä¸Šæ‰‹ä¸€ä¸ªå…·ä½“è€Œå¾®çš„ARMæ“ä½œç³»ç»Ÿ';
    };
  function loadComments() {
    var d = document, s = d.createElement('script');
    s.src = 'https://joou.disqus.com/embed.js';
    s.setAttribute('data-timestamp', '' + +new Date());
    (d.head || d.body).appendChild(s);
  }
  
    loadComments();
  
</script>





  


  
  <script>
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url).replace(/\/{2,}/g, '/');
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x"></i></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x"></i></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  

  

  
  <script>
    (function(){
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      bp.src = (curProtocol === 'https') ? 'https://zz.bdstatic.com/linksubmit/push.js' : 'http://push.zhanzhang.baidu.com/push.js';
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
    })();
  </script>


  

  

  

  
  
  
    
  
  <script src="//cdn.jsdelivr.net/npm/pangu@4/dist/browser/pangu.min.js"></script>
  <script>pangu.spacingPage();</script>


  

  
<script>
  $('.highlight').each(function(i, e) {
    var $wrap = $('<div>').addClass('highlight-wrap');
    $(e).after($wrap);
    $wrap.append($('<button>').addClass('copy-btn').append('å¤åˆ¶').on('click', function(e) {
      var code = $(this).parent().find('.code').find('.line').map(function(i, e) {
        return $(e).text();
      }).toArray().join('\n');
      var ta = document.createElement('textarea');
      var yPosition = window.pageYOffset || document.documentElement.scrollTop;
      ta.style.top = yPosition + 'px'; // Prevent page scroll
      ta.style.position = 'absolute';
      ta.style.opacity = '0';
      ta.readOnly = true;
      ta.value = code;
      document.body.appendChild(ta);
      ta.select();
      ta.setSelectionRange(0, code.length);
      ta.readOnly = false;
      var result = document.execCommand('copy');
      
        if (result) $(this).text('å¤åˆ¶æˆåŠŸ');
        else $(this).text('å¤åˆ¶å¤±è´¥');
      
      ta.blur(); // For iOS
      $(this).blur();
    })).on('mouseleave', function(e) {
      var $b = $(this).find('.copy-btn');
      setTimeout(function() {
        $b.text('å¤åˆ¶');
      }, 300);
    }).append(e);
  })
</script>


  

  

</body>
</html>
