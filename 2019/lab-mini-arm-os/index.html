<!DOCTYPE html>












  


<html class="theme-next mist use-motion" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">




  
  
    
      
    
    
      
    
  <script src="//cdn.jsdelivr.net/npm/pace-js@1/pace.min.js"></script>
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/pace-js@1/themes/blue/pace-theme-minimal.css">















  
  
    
  
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">







  

<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/font-awesome@4/css/font-awesome.min.css">

<link rel="stylesheet" href="/css/main.css?v=7.1.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/hacker.ico?v=7.1.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/hacker.ico?v=7.1.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/hacker.ico?v=7.1.0">


  <link rel="mask-icon" href="/images/hacker.ico?v=7.1.0" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '7.1.0',
    sidebar: {"position":"left","display":"hide","offset":12,"onmobile":true,"dimmer":true},
    back2top: true,
    back2top_sidebar: false,
    fancybox: true,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  

<meta name="baidu-site-verification" content="ChOTP1bKoM">


  <meta name="description" content="ËøôÊòØÊàëÁöÑÂµåÂÖ•ÂºèÁ¨îËÆ∞Á¨¨ÂõõÁØáÔºåÂéüÊñáÂÜô‰∫é2015Âπ¥„ÄÇ Âç∞Ë±°‰∏≠ÂõΩÂÜÖÁöÑÂµåÂÖ•ÂºèÂºÄÂèëËøòÊòØÔºàÂèØËÉΩÊòØÁõóÁâàÁöÑÔºâIDE Âä†ËΩΩÈ°πÁõÆÂ∑•Á®ãÂêé‰∏ÄÈîÆÁºñËØë/ÁÉßÂΩïÁöÑÊ®°ÂºèÔºåÂºÄÂèë‰∫∫ÂëòÂØπÂ∫ïÂ±ÇÂêÉÁöÑ‰∏çÂ§üÈÄèÔºåÁ¶ªÂºÄ IDE ÊàñËÄÖÊç¢‰∏™ÂºÄÂèëÁéØÂ¢ÉÁäπÂ¶ÇÊ∑±Â∫¶ËøëËßÜÊÇ£ËÄÖÁ¶ªÂºÄ‰∫ÜÁúºÈïú‚Äî‚ÄîÂØ∏Ê≠•ÈöæË°å„ÄÇÂÜçËØ¥Ëøú‰∏ÄÁÇπÔºå‰ºº‰πé‰∏çÂ∞ë‰∫∫ÁöÑÂ≠¶‰π†Ë∑ØÂæÑÈÉΩÊòØÈÄöËøáÁúã‰∏≠ÊñáÊïôÊùêÂíå‰∏Ä‰∫õÂüπËÆ≠Áè≠ËßÜÈ¢ëÔºàÊàëÂΩìÂπ¥‰πüÁúãËøáÈÉ≠Â§©Á••ÂíåÈü¶‰∏úÂ±±ÁöÑËßÜÈ¢ëüòÇÔºâÔºåÁº∫‰πè‚Äú‰∏ÄÊâã‚ÄùÁü•ËØÜÁöÑÊëÑÂèñÂíå‰ΩìÁ≥ªÂåñÁöÑËÆ≠ÁªÉ„ÄÇ Ëøô‰∏™ÂÆûÈ™åÈô§‰∫ÜÂèØ‰ª•Ê∑±ÂÖ•‰∫Ü">
<meta name="keywords" content="embedded system course,embedded system,arm,os,gnu,context switch">
<meta property="og:type" content="article">
<meta property="og:title" content="‰∏äÊâã‰∏Ä‰∏™ÂÖ∑‰ΩìËÄåÂæÆÁöÑARMÊìç‰ΩúÁ≥ªÁªü">
<meta property="og:url" content="https://blog.joouis.com/2019/lab-mini-arm-os/index.html">
<meta property="og:site_name" content="Ê±üËæπÁöÑÊó±È∏≠Â≠ê">
<meta property="og:description" content="ËøôÊòØÊàëÁöÑÂµåÂÖ•ÂºèÁ¨îËÆ∞Á¨¨ÂõõÁØáÔºåÂéüÊñáÂÜô‰∫é2015Âπ¥„ÄÇ Âç∞Ë±°‰∏≠ÂõΩÂÜÖÁöÑÂµåÂÖ•ÂºèÂºÄÂèëËøòÊòØÔºàÂèØËÉΩÊòØÁõóÁâàÁöÑÔºâIDE Âä†ËΩΩÈ°πÁõÆÂ∑•Á®ãÂêé‰∏ÄÈîÆÁºñËØë/ÁÉßÂΩïÁöÑÊ®°ÂºèÔºåÂºÄÂèë‰∫∫ÂëòÂØπÂ∫ïÂ±ÇÂêÉÁöÑ‰∏çÂ§üÈÄèÔºåÁ¶ªÂºÄ IDE ÊàñËÄÖÊç¢‰∏™ÂºÄÂèëÁéØÂ¢ÉÁäπÂ¶ÇÊ∑±Â∫¶ËøëËßÜÊÇ£ËÄÖÁ¶ªÂºÄ‰∫ÜÁúºÈïú‚Äî‚ÄîÂØ∏Ê≠•ÈöæË°å„ÄÇÂÜçËØ¥Ëøú‰∏ÄÁÇπÔºå‰ºº‰πé‰∏çÂ∞ë‰∫∫ÁöÑÂ≠¶‰π†Ë∑ØÂæÑÈÉΩÊòØÈÄöËøáÁúã‰∏≠ÊñáÊïôÊùêÂíå‰∏Ä‰∫õÂüπËÆ≠Áè≠ËßÜÈ¢ëÔºàÊàëÂΩìÂπ¥‰πüÁúãËøáÈÉ≠Â§©Á••ÂíåÈü¶‰∏úÂ±±ÁöÑËßÜÈ¢ëüòÇÔºâÔºåÁº∫‰πè‚Äú‰∏ÄÊâã‚ÄùÁü•ËØÜÁöÑÊëÑÂèñÂíå‰ΩìÁ≥ªÂåñÁöÑËÆ≠ÁªÉ„ÄÇ Ëøô‰∏™ÂÆûÈ™åÈô§‰∫ÜÂèØ‰ª•Ê∑±ÂÖ•‰∫Ü">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="https://jjrgxq.bn.files.1drv.com/y4mJ8PzIgxQl8A49jOlzN8ngCzqii5YaShYpXtm7oZFdUKMwF7GX1ZvPSBRvNfGjuLiBYh1YRzy5m9vWSIjvqP8TZMiALCPL7Y7_JcBbPlnbz9Y5YvrJOa1aR-YJcvnilcffA1dvNXRl0nl6ftucjPS_KPPAJPEC7gc3RGTIADvO3VyL08t_k_QhbIxEsv9M696VtfKDugudAjbONaHfx1rBA?width=665&height=196&cropmode=none">
<meta property="og:image" content="https://jjrexq.bn.files.1drv.com/y4mmQTIAfh9s6wUyEBnPh-M49mtDXgVblanK_JMDZ8AJvYcFVaQpvhGvPxWHAn6pD7_QbqJheIOAgjB1dYOut7kJea25hzUuiyfyK65bBOE1kJCDYyG3gvp_ARYSSckueCeag8T8ATchYqg7vHDg8eMVdoEs-S0rB2TS1p8VyPY-mDSQoxfT0GBxJEJs1LlOGJxjj-7UgZXqk0R55uykuA_ag?width=370&height=118&cropmode=none">
<meta property="og:image" content="https://jjrfxq.bn.files.1drv.com/y4msLq_CmDAujSrfYA8NuEC4ZHMdSokzk4fhPw5YtLQH5vRK5lTnPVFKRcXSDRJ218o_HUpoRvIU16gqEzz0hrYvwbtpAYbDUIw2645rEcIvYlGMMQFSj4K5OxC1tbFuul69ySeIejiKNiKMEa0D9Wk6k7xTN7ORra40ulPvgQP4N32iv3LjrqgG2RdMNLKZ4HRmQ6g3gZ5zMMYNaLagz4OeA?width=836&height=167&cropmode=none">
<meta property="og:image" content="https://jjrdxq.bn.files.1drv.com/y4mRQE5Fump95yZuOzBhNqQ7N5_mzTHEVTypYmPw6OHq2azZPtqvM4q-f1CQdM3kUuGab_l9cDzwEGC-g-wa2M8kUk_WTJOp6PJslaqSky-9HJ5P53vGzibCYaJ1D2_jXAc1eePfITeY4U7wj74WMt84mXkivWuGUX_F-xlWEItxxLJriI_-qID5ZYLFL0nFYYgQT_L1hRr6h2Nc4Mlcp7Wag?width=330&height=182&cropmode=none">
<meta property="og:image" content="https://jjrcxq.bn.files.1drv.com/y4mxOrwfjpJWXVx10ewRnky1wPwqh2R11XAqx-rK7fYKhfnw0_Q74JArry9kVVn4BgN9X-_uc522FXUMVpDK12AMd4YZJsgAQUcUVqHyS46IaGAxRHw-BAwiecYzVgzOaHf2UiuOJ7Tpfs0_N-XTSa7WMGoHru9BdASIGz_T5kmQcuOST6itBFfUUH9IMIbg8uY6Jqo4lWKAnkXSwQfbY6U-Q?width=710&height=457&cropmode=none">
<meta property="og:image" content="https://jjrbxq.bn.files.1drv.com/y4muhuffNAohfnDo-aRDoceuibQPrQEckKbjI4lHjnPFIs9WGd06YSErr1D8mnXD44UqViR2HMQmQ4_wvzsxaCkigz4_EXVvtf8zNBv0r4nCwYj0vwSCu8gaLkmEC28hMXaJ9VXQf0hhqjehXva9wzBL_zppfNl8mBUBl447u-Ml279njbjec48_ELzLOrV7Vcx3spyKlothXlN8JfhBB-NiQ?width=524&height=422&cropmode=none">
<meta property="og:updated_time" content="2019-12-29T14:21:16.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="‰∏äÊâã‰∏Ä‰∏™ÂÖ∑‰ΩìËÄåÂæÆÁöÑARMÊìç‰ΩúÁ≥ªÁªü">
<meta name="twitter:description" content="ËøôÊòØÊàëÁöÑÂµåÂÖ•ÂºèÁ¨îËÆ∞Á¨¨ÂõõÁØáÔºåÂéüÊñáÂÜô‰∫é2015Âπ¥„ÄÇ Âç∞Ë±°‰∏≠ÂõΩÂÜÖÁöÑÂµåÂÖ•ÂºèÂºÄÂèëËøòÊòØÔºàÂèØËÉΩÊòØÁõóÁâàÁöÑÔºâIDE Âä†ËΩΩÈ°πÁõÆÂ∑•Á®ãÂêé‰∏ÄÈîÆÁºñËØë/ÁÉßÂΩïÁöÑÊ®°ÂºèÔºåÂºÄÂèë‰∫∫ÂëòÂØπÂ∫ïÂ±ÇÂêÉÁöÑ‰∏çÂ§üÈÄèÔºåÁ¶ªÂºÄ IDE ÊàñËÄÖÊç¢‰∏™ÂºÄÂèëÁéØÂ¢ÉÁäπÂ¶ÇÊ∑±Â∫¶ËøëËßÜÊÇ£ËÄÖÁ¶ªÂºÄ‰∫ÜÁúºÈïú‚Äî‚ÄîÂØ∏Ê≠•ÈöæË°å„ÄÇÂÜçËØ¥Ëøú‰∏ÄÁÇπÔºå‰ºº‰πé‰∏çÂ∞ë‰∫∫ÁöÑÂ≠¶‰π†Ë∑ØÂæÑÈÉΩÊòØÈÄöËøáÁúã‰∏≠ÊñáÊïôÊùêÂíå‰∏Ä‰∫õÂüπËÆ≠Áè≠ËßÜÈ¢ëÔºàÊàëÂΩìÂπ¥‰πüÁúãËøáÈÉ≠Â§©Á••ÂíåÈü¶‰∏úÂ±±ÁöÑËßÜÈ¢ëüòÇÔºâÔºåÁº∫‰πè‚Äú‰∏ÄÊâã‚ÄùÁü•ËØÜÁöÑÊëÑÂèñÂíå‰ΩìÁ≥ªÂåñÁöÑËÆ≠ÁªÉ„ÄÇ Ëøô‰∏™ÂÆûÈ™åÈô§‰∫ÜÂèØ‰ª•Ê∑±ÂÖ•‰∫Ü">
<meta name="twitter:image" content="https://jjrgxq.bn.files.1drv.com/y4mJ8PzIgxQl8A49jOlzN8ngCzqii5YaShYpXtm7oZFdUKMwF7GX1ZvPSBRvNfGjuLiBYh1YRzy5m9vWSIjvqP8TZMiALCPL7Y7_JcBbPlnbz9Y5YvrJOa1aR-YJcvnilcffA1dvNXRl0nl6ftucjPS_KPPAJPEC7gc3RGTIADvO3VyL08t_k_QhbIxEsv9M696VtfKDugudAjbONaHfx1rBA?width=665&height=196&cropmode=none">



  <link rel="alternate" href="/atom.xml" title="Ê±üËæπÁöÑÊó±È∏≠Â≠ê" type="application/atom+xml">



  
  
  <link rel="canonical" href="https://blog.joouis.com/2019/lab-mini-arm-os/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>‰∏äÊâã‰∏Ä‰∏™ÂÖ∑‰ΩìËÄåÂæÆÁöÑARMÊìç‰ΩúÁ≥ªÁªü | Ê±üËæπÁöÑÊó±È∏≠Â≠ê</title>
  




  <script async src="//www.googletagmanager.com/gtag/js?id=UA-76188004-1"></script>
  <script>
    var host = window.location.hostname;
    if (host !== "localhost" || !true) {
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-76188004-1');
    }
  </script>



  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?199f195e233fd5ecca0d9346d3259670";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>







  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Ê±üËæπÁöÑÊó±È∏≠Â≠ê</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <h1 class="site-subtitle" itemprop="description">Blog of Joou</h1>
      
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="ÂàáÊç¢ÂØºËà™Ê†è">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    

    

    <a href="/" rel="section">È¶ñÈ°µ</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    

    

    <a href="/archives/" rel="section">ÂΩíÊ°£</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
    

    

    <a href="/categories/" rel="section">ÂàÜÁ±ª</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-about">

    
    
    

    

    <a href="/about/" rel="section">ÂÖ≥‰∫é</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-recruit">

    
    
    

    

    <a href="/recruit/" rel="section">ÊãõËÅò</a>

  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            ÊêúÁ¥¢</a>
        </li>
      
    </ul>
  

  
    

  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="ÊêúÁ¥¢..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.joouis.com/2019/lab-mini-arm-os/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Chou">
      <meta itemprop="description" content="Stand high, think different.">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ê±üËæπÁöÑÊó±È∏≠Â≠ê">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">‰∏äÊâã‰∏Ä‰∏™ÂÖ∑‰ΩìËÄåÂæÆÁöÑARMÊìç‰ΩúÁ≥ªÁªü

              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">ÂèëË°®‰∫é</span>
              

              
                
              

              <time title="ÂàõÂª∫Êó∂Èó¥Ôºö2019-12-29 22:21:16" itemprop="dateCreated datePublished" datetime="2019-12-29T22:21:16+08:00">2019-12-29</time>
            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">ÂàÜÁ±ª‰∫é</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Á≥ªÁªü‰∏éÂ∫ïÂ±Ç/" itemprop="url" rel="index"><span itemprop="name">Á≥ªÁªü‰∏éÂ∫ïÂ±Ç</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          
            <div class="post-symbolscount">
              
                <span class="post-meta-divider">|</span>
              

              

              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">ÈòÖËØªÊó∂Èïø &asymp;</span>
                
                <span title="ÈòÖËØªÊó∂Èïø">14 ÂàÜÈíü</span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>ËøôÊòØÊàëÁöÑ<a href="https://blog.joouis.com/2019/watching-notes-revolution-os/">ÂµåÂÖ•ÂºèÁ¨îËÆ∞</a>Á¨¨ÂõõÁØáÔºåÂéüÊñáÂÜô‰∫é2015Âπ¥„ÄÇ</p>
<p>Âç∞Ë±°‰∏≠ÂõΩÂÜÖÁöÑÂµåÂÖ•ÂºèÂºÄÂèëËøòÊòØÔºàÂèØËÉΩÊòØÁõóÁâàÁöÑÔºâIDE Âä†ËΩΩÈ°πÁõÆÂ∑•Á®ãÂêé‰∏ÄÈîÆÁºñËØë/ÁÉßÂΩïÁöÑÊ®°ÂºèÔºåÂºÄÂèë‰∫∫ÂëòÂØπÂ∫ïÂ±ÇÂêÉÁöÑ‰∏çÂ§üÈÄèÔºåÁ¶ªÂºÄ IDE ÊàñËÄÖÊç¢‰∏™ÂºÄÂèëÁéØÂ¢ÉÁäπÂ¶ÇÊ∑±Â∫¶ËøëËßÜÊÇ£ËÄÖÁ¶ªÂºÄ‰∫ÜÁúºÈïú‚Äî‚ÄîÂØ∏Ê≠•ÈöæË°å„ÄÇÂÜçËØ¥Ëøú‰∏ÄÁÇπÔºå‰ºº‰πé‰∏çÂ∞ë‰∫∫ÁöÑÂ≠¶‰π†Ë∑ØÂæÑÈÉΩÊòØÈÄöËøáÁúã‰∏≠ÊñáÊïôÊùêÂíå‰∏Ä‰∫õÂüπËÆ≠Áè≠ËßÜÈ¢ëÔºàÊàëÂΩìÂπ¥‰πüÁúãËøáÈÉ≠Â§©Á••ÂíåÈü¶‰∏úÂ±±ÁöÑËßÜÈ¢ëüòÇÔºâÔºåÁº∫‰πè‚Äú‰∏ÄÊâã‚ÄùÁü•ËØÜÁöÑÊëÑÂèñÂíå‰ΩìÁ≥ªÂåñÁöÑËÆ≠ÁªÉ„ÄÇ</p>
<p>Ëøô‰∏™ÂÆûÈ™åÈô§‰∫ÜÂèØ‰ª•Ê∑±ÂÖ•‰∫ÜËß£Êìç‰ΩúÁ≥ªÁªüÁöÑÂ∫ïÂ±ÇË°å‰∏∫Â¶Ç‰∏ä‰∏ãÊñáÂàáÊç¢Â§ñÔºåËøòÊúâ‰∏Ä‰∏™ÈöæÁÇπÂ∞±ÊòØË¶ÅÂú® Linux ÁéØÂ¢É‰∏ã‰ΩøÁî® GNU Toolchain ÁºñËØëÈìæÊé•Á≥ªÁªüÔºåÊúÄÁªàÁÉßÂΩïÂà∞ ARM Á°¨‰ª∂‰∏äÔºåÈùûÂ∏∏ÈùûÂ∏∏ÁöÑ‚ÄúÁ°¨Ê†∏‚Äù„ÄÇ</p>
<a id="more"></a>
<h2 id="ÂáÜÂ§áÂ∑•‰Ωú"><a href="#ÂáÜÂ§áÂ∑•‰Ωú" class="headerlink" title="ÂáÜÂ§áÂ∑•‰Ωú"></a>ÂáÜÂ§áÂ∑•‰Ωú</h2><p>Êàë‰ª¨‰ΩøÁî®ÁöÑÁ°¨‰ª∂ÊòØÊÑèÊ≥ïÂçäÂØº‰ΩìÂá∫ÁöÑ STM32F4 Discovery ÂºÄÂèëÊùøÔºåÂú®ÂºÄÂßãÂÆûÈ™å‰πãÂâçÔºå‰∫ÜËß£ MCU„ÄÅÁîµË∑ØÂ∏ÉÂ±Ä‰ª•ÂèäÂ¶Ç‰ΩïÂú® STM32 MCU ‰∏äÂºÄÂèëÈÉΩÊòØÂøÖ‰∏çÂèØÁº∫ÁöÑÊ≠•È™§Ôºå‰∏ªË¶ÅÂ∞±ÊòØÈòÖËØªÂ§ßÈáèËµÑÊñô„ÄÇ</p>
<ul>
<li><a href="https://docs.google.com/document/d/1Ygl6cEGPXUffhTJE0K6B8zEtGmIuIdCjlZBkFlijUaE/edit" target="_blank" rel="noopener">STM32 Á®ãÂºèÈñãÁôºÔºö‰ª• GNU Toolchain ÁÇ∫‰æã</a></li>
<li>ld: <a href="http://www.math.utah.edu/docs/info/ld_toc.html#SEC1" target="_blank" rel="noopener">Using ld, The GNU linker</a>, <a href="http://wen00072-blog.logdown.com/posts/246071-study-on-the-linker-script-3" target="_blank" rel="noopener">GNU LD ÊâãÂÜäÁï•ËÆÄ (3): Chapter 3.7 ~ Chapter 3.11</a></li>
<li>STM32: Reference Manual, Datasheet, SchematicsÔºàËá™Ë°åÊü•ÈòÖÂÆòÁΩëÊúÄÊñ∞ÁâàÊú¨Ôºâ</li>
<li>Course: <a href="http://wiki.csie.ncku.edu.tw/embedded/Lab42" target="_blank" rel="noopener">Lab42: Mini ARM OS</a></li>
</ul>
<h2 id="Mini-ARM-OS"><a href="#Mini-ARM-OS" class="headerlink" title="Mini ARM OS"></a><a href="https://github.com/jserv/mini-arm-os" target="_blank" rel="noopener">Mini ARM OS</a></h2><p>GitHub ‰ªìÂ∫ìÁÇπÂáªÊ†áÈ¢òÂç≥ÂèØËÆøÈóÆÔºåÊ≤°ÊÉ≥Âà∞Â∑≤ÁªèÊúâ 530 È¢óÊòüÊòü‰∫ÜÔºà12/29/2019ÔºâÔºÅ‰ª•‰∏ãÁ¨îËÆ∞ÂØπÂ∫îÂõõÂπ¥ÂâçÁöÑÁâàÊú¨ÔºåÂ∞ë‰∫ÜÁ¨¨ 7 ÂíåÁ¨¨ 8 ËØæÔºå‰ª£Á†ÅÂèØËÉΩ‰πüÊúâÊâÄÊîπÂä®ÔºåÂãøÊÄ™„ÄÇ</p>
<h3 id="00-HelloWorld"><a href="#00-HelloWorld" class="headerlink" title="00-HelloWorld"></a>00-HelloWorld</h3><ul>
<li><p>ÂÖàmakeÁÑ∂Âæåmake qemuÂæåÂá∫Áèæhello worldÔºåÁÑ∂ÂæåËº∏ÂÖ•arm-none-eabi-objdump -D hello.elfÊü•Áúãexecutable and linkableÊñá‰ª∂</p>
<p><img src="https://jjrgxq.bn.files.1drv.com/y4mJ8PzIgxQl8A49jOlzN8ngCzqii5YaShYpXtm7oZFdUKMwF7GX1ZvPSBRvNfGjuLiBYh1YRzy5m9vWSIjvqP8TZMiALCPL7Y7_JcBbPlnbz9Y5YvrJOa1aR-YJcvnilcffA1dvNXRl0nl6ftucjPS_KPPAJPEC7gc3RGTIADvO3VyL08t_k_QhbIxEsv9M696VtfKDugudAjbONaHfx1rBA?width=665&amp;height=196&amp;cropmode=none" alt></p>
<p><img src="https://jjrexq.bn.files.1drv.com/y4mmQTIAfh9s6wUyEBnPh-M49mtDXgVblanK_JMDZ8AJvYcFVaQpvhGvPxWHAn6pD7_QbqJheIOAgjB1dYOut7kJea25hzUuiyfyK65bBOE1kJCDYyG3gvp_ARYSSckueCeag8T8ATchYqg7vHDg8eMVdoEs-S0rB2TS1p8VyPY-mDSQoxfT0GBxJEJs1LlOGJxjj-7UgZXqk0R55uykuA_ag?width=370&amp;height=118&amp;cropmode=none" alt></p>
</li>
<li><p>ÈÄôË£èÂÄºÂæóÊ≥®ÊÑèÁöÑÊòØÔºåÂú®M3‰∏äÈõªÂèñÂá∫MSPÂæåÔºåÊúÉÂèñÂá∫PCÁöÑÂÄºÔºåÂúñ‰∏≠ÂèØË¶ãÊòØ0x000000ad„ÄÇ‰ΩÜÂØ¶Èöõ‰∏äreset_handlerÂú∞ÂùÄÊòØÂæû000000acÈñãÂßãÁöÑ„ÄÇÈÄôÊòØÂõ†Áà≤Ôºö</p>
<p>Áï∂‰∏ÄÂÄã‰æãÂ§ñËôïÁêÜÁ®ãÂºè(exception handler)ÁöÑ‰ΩçÂùÄÂú®LSBË®≠ÂÆöÁÇ∫1Ôºå‰ª£Ë°®Ë©≤‰æãÂ§ñËôïÁêÜÁ®ãÂºèÈÅã‰ΩúÊñºThumbÊ®°Âºè(Thumb mode)ÔºåÂ∞çARM Cortex-M3‰æÜË™™ÔºåÈÄôÊòØÂøÖË¶ÅÁöÑÔºåÂõ†ÁÇ∫Ë©≤ËôïÁêÜÂô®Ê†∏ÂøÉÂè™ÊîØÊè¥Thumb-2Êåá‰ª§ÈõÜÔºåËÄå‰∏çÊîØÊè¥ARMÊ®°Âºè(‰πüÁ®±ARM codeÊàñARM state)„ÄÇ</p>
<p>ÊâÄ‰ª•<a href="http://wiki.csie.ncku.edu.tw/embedded/Lab42" target="_blank" rel="noopener">http://wiki.csie.ncku.edu.tw/embedded/Lab42</a> ÁöÑÊà™ÂúñË£èÔºåreset_handlerÊòØÂæû0x000000adÊòØÂØ¶ÈöõÁ∑®Ë≠ØÂô®Âú®‰∏çÂêåÊ©üÂô®‰∏ãÁ∑®Ë≠ØÂá∫‰æÜÁöÑ‰∏çÂêåÔºü</p>
</li>
<li><p>Êê≠ÈÖçhello.ldÂíåstartup.c‰∏ÄËµ∑ÁúãÁµÇÊñºÊúâÁ®ÆÊÅçÁÑ∂Â§ßÊÇüÁöÑÊÑüË¶∫„ÄÇ.text sectionÊúÄÂâçÈù¢ÁöÑ‰ΩçÁΩÆÂ∞±ÊòØisr_vectorÔºåÁÑ∂ÂæåÂÜçÊòØÂÖ∂‰ªñ.textÊñá‰ª∂„ÄÇÁï∂m3ÂæûFlashÈñãÂßãËÆÄÂÖ•Êï∏ÊìöÊôÇÔºåÈ¶ñÂÖàÂ∞±ÊòØisr_vectorÁöÑÂÖßÂÆπÔºåËÄåisr_vector‰∏≠È¶ñÂÖàÁµ¶MSPÂú∞ÂùÄË≥¶0ÔºåÁÑ∂ÂæåÊòØreset_handlerÔºåËÄåreset_handlerÊåáÂêëMainÂáΩÊï∏ÔºåÈÄôÊ®£Â∞±Â∞éÂÖ•ÊàëÂÄëÂØ´ÁöÑ‰∏ªÂáΩÊï∏‰∫Ü</p>
</li>
</ul>
<h3 id="01-HelloWorld"><a href="#01-HelloWorld" class="headerlink" title="01-HelloWorld"></a>01-HelloWorld</h3><ul>
<li><p>Ê≠§ÂØ¶È©óÂíå00Áõ∏ÊØîÂú®ld‰∏ä‰Ωú‰∫ÜÊõ¥Â§öÊñáÁ´†„ÄÇ00-HelloWorldÁöÑldÊñá‰ª∂ÂÉÖÈÖçÁΩÆ‰∫ÜFlashÂíå.text sectionÔºåËÄå01‰∏≠ÂâáÂ§öÈÖçÁΩÆ‰∫ÜRAMÔºåÂ∞áÈÅãË°åÊôÇ‰∏çÊúÉÊõ¥ÊîπÁöÑ.text„ÄÅ.rodata„ÄÅÊîæÂÖ•.text section‰∏≠Ôºå.dataÊîæÂÖ•.data section‰∏≠</p>
</li>
<li><p>ATÁöÑ_sidataË°®Á§∫‰∫Ü.dataËºâÂÖ•RAMÂæåÁöÑLMA„ÄÇÂõ†Áà≤data sectionÊúÉÂæûflashÊê¨ÁßªÂà∞SRAM‰∏≠ÔºåÂõ†Ê≠§ÂÆÉÁöÑLMAÂíåVMAÊúÉ‰∏çÂêå„ÄÇÈÄ£ÁµêÂô®ËÖ≥Êú¨ÁöÑ‰∏ÄÂÄãÈáçË¶Å‰ΩúÁî®ÔºåÂ∞±ÊòØÁÆ°ÁêÜÂÄãÂà•sectionÁöÑLMAÂíåVMAÔºå‰∏¶Âú®ÂøÖË¶ÅÁöÑÊÉÖÊ≥Å‰∏ãÔºåÊääÊúâÈóúË≥áË®äÊèê‰æõÁµ¶Á®ãÂºèÁ®ãÂºèÁ¢º‰ΩøÁî®„ÄÇ</p>
</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Copy the data segment initializers from flash to SRAM */</span></span><br><span class="line"><span class="keyword">uint32_t</span> *idata_begin = &amp;_sidata;</span><br><span class="line"><span class="keyword">uint32_t</span> *data_begin = &amp;_sdata;</span><br><span class="line"><span class="keyword">uint32_t</span> *data_end = &amp;_edata;</span><br><span class="line"><span class="keyword">while</span> (data_begin &lt; data_end) *data_begin++ = *idata_begin++;</span><br></pre></td></tr></table></figure>
<h3 id="02-ContextSwitch-1"><a href="#02-ContextSwitch-1" class="headerlink" title="02-ContextSwitch-1"></a>02-ContextSwitch-1</h3><ul>
<li>Âú®startup.c‰∏≠ÂÆöÁæ©‰∫Ünmi_handlerÂíåhardfault_handlerÔºåÂú∞ÂùÄÂú®reset_handler‰πãÂæåÔºå‰ªÄÈ∫ºÊôÇÂÄôÊúÉËß∏Áôº‰ªñÂÄëÂë¢Ôºü</li>
<li>mspÁöÑÂÄºÁà≤_estack=RAMÁöÑÂàùÂßã‰ΩçÁΩÆÂä†‰∏äRAMÁöÑÂØ¨Â∫¶ÔºåÂç≥0x20000000+40kÔºåÈÄôÊ®£ÊÑèÂë≥ÈÄôstackÁöÑÁà≤40KÂ§ßÂ∞èÔºåÈÄôÂÄãÂ§ßÂ∞èÁöÑstackÊÑüË¶∫Ë∂≥Â§†ÂØ¨Ë£ïÔºÅ</li>
<li>Êé•ÁùÄÁúãos.cË£èÁöÑmainÂáΩÊï∏<ul>
<li>cortex-mÁ≥ªÂàóËôïÁêÜÂô®<a href="http://infocenter.arm.com/help/index.jsp?topic=/com.arm.doc.dui0552a/CHDBIBGJ.html" target="_blank" rel="noopener">core registers</a></li>
<li>È¶ñÂÖàÂÆöÁæ©È°çusertaskÁöÑÂ†ÜÊ£ßÂ§ßÂ∞è256<em>4byte=1kÔºåÁÑ∂ÂæåÂÆöÁæ©‰∏ÄÂÄãÊåáÈáù\</em>usertask_stack_startÊåáÂêëusertaskÂ†ÜÊ£ßÂä†256-16ÁöÑË∑ùÈõ¢ÔºåËÄåusertaskÁöÑÂú∞ÂùÄÂæûusertask_stack_startÊ£ßÂ∫ï-8ÊâçÈñãÂßãÔºåÈÄô‰∏≠ÈñìÂ§öÂá∫‰∫Ü24byte„ÄÇÊàëÊÉ≥ÈÄôÊáâË©≤ÊòØcall stackÁöÑÊ¶ÇÂøµÔºåÁà≤‰∫ÜÂæåÈñÄË™øÁî®usertaskÂáΩÊï∏ÁöÑargument„ÄÅreturn address„ÄÅsaved ebp%Á≠âÁïô‰∏ãÁ©∫Èñì(24byteÊáâË©≤ÊòØ6ÂÄãÁ©∫Ê†º)</li>
</ul>
</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">/* Initialization of process stack.</span></span><br><span class="line"><span class="comment">     * r4, r5, r6, r7, r8, r9, r10, r11, lr</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> usertask_stack[<span class="number">256</span>];</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> *usertask_stack_start = usertask_stack + <span class="number">256</span> - <span class="number">16</span>;</span><br><span class="line">    usertask_stack_start[<span class="number">8</span>] = (<span class="keyword">unsigned</span> <span class="keyword">int</span>) &amp;usertask;</span><br><span class="line"></span><br><span class="line">    usart_init();</span><br><span class="line"></span><br><span class="line">    print_str(<span class="string">"OS Starting...\n"</span>);</span><br><span class="line">    activate(usertask_stack_start);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// while (1); /* We can't exit, there is nowhere to go */</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>contex_swtich.s‰∏≠.syntax unifiedÔºöCortex-m3Áà≤‰∫ÜÂÖºÂÆπthumbÊåá‰ª§Âíåthumb2Êåá‰ª§Ôºå‰ΩøÈÄôÂÖ©Á®ÆÊåá‰ª§ÂèØ‰ª•‰ΩøÁî®Áµ±‰∏ÄÁöÑÊ†ºÂºèÔºåÂºïÂÖ•‰∫Ü‰∏ÄÁ®ÆÂè´ÂÅö‚ÄúUAL‚ÄùÁöÑË™ûÊ≥ïÊ©üÂà∂„ÄÇÁ∞°ÂñÆË™™‰æÜÂ∞±ÊòØÁ®ãÂ∫èÂì°‰∏çÁî®ÈóúÂøÉËá™Â∑±‰ΩøÁî®ÁöÑÊòØthumbÈÇÑÊòØthumb2Êåá‰ª§ÔºåËÄåÊòØÁµ±‰∏Ä‰ΩøÁî®32‰Ωçthumb2Êåá‰ª§ÁöÑË™ûÊ≥ïÊ†ºÂºèÊõ∏ÂØ´„ÄÇÂÖ∑È´îÁöÑÊ©üÂô®Êåá‰ª§ÊòØ16‰ΩçÈÇÑÊòØ32‰ΩçÁî±Á∑®Ë≠ØÂô®‰æÜÊ±∫ÂÆö„ÄÇ.syntax unifiedÁöÑ‰ΩúÁî®Â∞±ÊòØÂà∂ÂÆö‰ΩøÁî®ÈÄô‰∏ÄÂäüËÉΩÔºåÂÖ∑È´îÂèØ‰ª•ÂèÉËÄÉ„Ääcortex-m3Ê¨äÂ®ÅÊåáÂçó„Äã„ÄÇ</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">/* save kernel state */</span><br><span class="line">mrs ip, psr</span><br><span class="line">push &#123;r4, r5, r6, r7, r8, r9, r10, r11, ip, lr&#125;</span><br><span class="line">/* switch to process stack */</span><br><span class="line">msr psp, r0</span><br><span class="line">mov r0, #3</span><br><span class="line">msr control, r0</span><br><span class="line">/* load user state */</span><br><span class="line">pop &#123;r4, r5, r6, r7, r8, r9, r10, r11, lr&#125;</span><br><span class="line">/* jump to user task */</span><br><span class="line">bx lr</span><br></pre></td></tr></table></figure>
<ul>
<li><p>Êé•ÁùÄÈÄôÊÆµ‰ª£Á¢ºÔºö</p>
<ul>
<li><p>MRSÔºöMove to ARM register from system coprocessor register. MRS <em>Rn</em>, <em>coproc_register</em>‰∏≠Rn is the ARM destination register, and R<em>n</em> must not be PC. System coprocessor registerÊáâË©≤ÊòØÈÇ£‰∫õspecial registersÔºåÂÖ∂‰∏≠ÂåÖÂê´psr(Program status register)„ÄÇMSRÂèç‰πã„ÄÇ</p>
</li>
<li><p>Â∞ámainÂáΩÊï∏(kernel)ÁöÑÁãÄÊÖãÂ≠òÂÖ•Â†ÜÊ£ßÂæåÔºåÂ∞ár0Êï∏ÊìöÂ≠òÂÖ•Á®ãÂ∫èÁãÄÊÖãÂØÑÂ≠òÂô®(Ê≠§ÊôÇr0ÊáâË©≤Â≠òÊîæ‰∫Üusertask_stack_startÂú∞ÂùÄ)ÔºåÁÑ∂ÂæåË®≠ÂÆö<a href="http://infocenter.arm.com/help/index.jsp?topic=/com.arm.doc.dui0552a/CHDBIBGJ.html" target="_blank" rel="noopener">controlÂØÑÂ≠òÂô®</a>Áà≤0b11„ÄÇÊâÄ‰ª•ÁèæÂú®stack pointerÊòØPSPÔºåËÄåPSP‰∏≠Â≠òÊîæÁöÑÊòØusertask_stack_startÂú∞ÂùÄÔºåËá≥ÊñºThread modeÊòØUnprivileged„ÄÇ</p>
<p><img src="https://jjrfxq.bn.files.1drv.com/y4msLq_CmDAujSrfYA8NuEC4ZHMdSokzk4fhPw5YtLQH5vRK5lTnPVFKRcXSDRJ218o_HUpoRvIU16gqEzz0hrYvwbtpAYbDUIw2645rEcIvYlGMMQFSj4K5OxC1tbFuul69ySeIejiKNiKMEa0D9Wk6k7xTN7ORra40ulPvgQP4N32iv3LjrqgG2RdMNLKZ4HRmQ6g3gZ5zMMYNaLagz4OeA?width=836&amp;height=167&amp;cropmode=none" alt></p>
</li>
<li><p>ÊúÄÂæåÊääusertask_stack‰∏≠ÁöÑÂØÑÂ≠òÂô®ÂÄºÊãøÂá∫‰æÜÔºåÂ∞±ÂèØ‰ª•Ë∑≥ËΩâÂà∞user state‰∫Ü</p>
</li>
<li><p>Ê≠§Â§ÑË°•ÂÖÖ‰∏§ÁØá ARM ÂÆòÊñπÊñáÊ°£Ôºö<a href="http://infocenter.arm.com/help/index.jsp?topic=/com.arm.doc.dai0179b/ar01s02s06.html" target="_blank" rel="noopener">2.6. Execution Modes</a>, <a href="http://infocenter.arm.com/help/index.jsp?topic=/com.arm.doc.dui0552a/CHDIGFCA.html" target="_blank" rel="noopener">2.1.1. Processor mode and privilege levels for software execution</a></p>
</li>
</ul>
</li>
</ul>
<h3 id="03-ContextSwitch-2"><a href="#03-ContextSwitch-2" class="headerlink" title="03-ContextSwitch-2"></a>03-ContextSwitch-2</h3><ul>
<li>startup.c‰∏≠Â§ö‰∫Ü‰∏Ä‰∫õËÅ≤ÊòéÔºö</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">nmi_handler</span><span class="params">(<span class="keyword">void</span>)</span> __<span class="title">attribute</span><span class="params">((weak, alias(<span class="string">"default_handler"</span>)))</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">hardfault_handler</span><span class="params">(<span class="keyword">void</span>)</span> __<span class="title">attribute</span><span class="params">((weak, alias(<span class="string">"default_handler"</span>)))</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">memmanage_handler</span><span class="params">(<span class="keyword">void</span>)</span> __<span class="title">attribute</span><span class="params">((weak, alias(<span class="string">"default_handler"</span>)))</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">busfault_handler</span><span class="params">(<span class="keyword">void</span>)</span> __<span class="title">attribute</span><span class="params">((weak, alias(<span class="string">"default_handler"</span>)))</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">usagefault_handler</span><span class="params">(<span class="keyword">void</span>)</span> __<span class="title">attribute</span><span class="params">((weak, alias(<span class="string">"default_handler"</span>)))</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">svc_handler</span><span class="params">(<span class="keyword">void</span>)</span> __<span class="title">attribute</span><span class="params">((weak, alias(<span class="string">"default_handler"</span>)))</span></span>;</span><br></pre></td></tr></table></figure>
<ul>
<li>alias (‚Äútarget‚Äù): The alias attribute causes the declaration to be emitted as an alias for another symbol, which must be specified.</li>
<li>ÊâÄ‰ª•*_handlerÂÖ®ÈÉ®aliasÂà∞‰∫Üdefault_handler‰∏äÔºåËÄådefault_handlerÁõÆÂâçÁà≤‰∏ÄÂÄãÊ≠ªÂæ™Áí∞Ôºö</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">default_handler</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>syscallÁöÑÂÆöÁæ©ÔºåÈóúÊñº <code>svc 0</code> ÈÄôÂÄã<a href="https://reverseengineering.stackexchange.com/questions/4217/arm-shellcode-for-linux-svc-0-vs-svc-1" target="_blank" rel="noopener">ÂõûÁ≠î</a>ÂæàÂ•Ω</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">syscall:</span><br><span class="line">    svc 0</span><br><span class="line">    nop</span><br><span class="line">    bx lr</span><br></pre></td></tr></table></figure>
<ul>
<li>Âú®context_switch.S‰∏≠ÂÆöÁæ©‰∫Üsvc_handlerÂáΩÊï∏ÔºåËÅØÊÉ≥Âà∞startup.c‰∏≠ÁöÑweak aliasÔºåÂèØ‰ª•ÁêÜËß£weak aliasÁöÑÊÑèÊÄùÂ∞±ÊòØÁ∑®Ë≠ØÂô®ÂÅáÂ¶ÇÂú®Êñá‰ª∂‰∏≠ÊâæÂà∞‰∫ÜÊüêÂÄãÂáΩÊï∏ÁöÑÂÆöÁæ©Â∞±ÊúÉÁ∑®Ë≠ØÔºåÂÅáÂ¶ÇÊ≤íÊúâÊâæÂà∞Â∞±ÊúÉÂ∞áÂÖ∂aliasÂà∞ÊåáÂÆöÁöÑweak aliasÂáΩÊï∏„ÄÇ<ul>
<li>ÈóúÊñº<a href="http://infocenter.arm.com/help/index.jsp?topic=/com.arm.doc.dui0552a/BABCAEDD.html" target="_blank" rel="noopener">stmdb</a>Ôºåstm‰ª£Ë°®Â≠òÂÑ≤Êõ¥Â§öÂØÑÂ≠òÂô®Ôºådb‰ª£Ë°®Âú®Áç≤ÂèñÂâçÂ∞áÂú∞ÂùÄÊ∏õÂ∞è„ÄÇÊâÄ‰ª•Â∞±ÊòØr0Âú∞ÂùÄÊúÉÂ¢ûÂä†9*4bytesÔºåÁÑ∂ÂæåÂ∞á{}‰∏≠ÁöÑ9ÂÄãÂØÑÂ≠òÂô®ÂæûÂ∑¶Ëá≥Âè≥ÂæûÊúÄ‰Ωé‰ΩçÁΩÆÈñãÂßãÂ≠òÊîæ</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">svc_handler:</span><br><span class="line">	/* save user state */</span><br><span class="line">    mrs r0, psp</span><br><span class="line">    stmdb r0!, &#123;r4, r5, r6, r7, r8, r9, r10, r11, lr&#125;</span><br><span class="line"></span><br><span class="line">    /* load kernel state */</span><br><span class="line">    pop &#123;r4, r5, r6, r7, r8, r9, r10, r11, ip, lr&#125;</span><br><span class="line">    msr psr, ip</span><br><span class="line"></span><br><span class="line">    bx lr</span><br></pre></td></tr></table></figure>
<p><img src="https://jjrdxq.bn.files.1drv.com/y4mRQE5Fump95yZuOzBhNqQ7N5_mzTHEVTypYmPw6OHq2azZPtqvM4q-f1CQdM3kUuGab_l9cDzwEGC-g-wa2M8kUk_WTJOp6PJslaqSky-9HJ5P53vGzibCYaJ1D2_jXAc1eePfITeY4U7wj74WMt84mXkivWuGUX_F-xlWEItxxLJriI_-qID5ZYLFL0nFYYgQT_L1hRr6h2Nc4Mlcp7Wag?width=330&amp;height=182&amp;cropmode=none" alt></p>
<ul>
<li>Á®ãÂ∫èrunÂèØË¶ãÁï∂usertaskËß∏ÁôºsyscallÂæåÊúÉ‰øùÂ≠òÂÖ∂ÁãÄÊÖãÔºåÁÑ∂ÂæåÂàáÂõûmainÂáΩÊï∏Ëº∏Âá∫ÂÖ©ÂÄãprint_strÔºåÁÑ∂ÂæåÂõûÂà∞usertaskÂæåÊúÉÁπºÁ∫åÊé•ÁùÄ‰∏ä‰∏ÄÊ¨°ÁöÑÂü∑Ë°åÂà∞ÁöÑÂú∞ÊñπÁπºÁ∫åÂü∑Ë°åÔºåÂÜçËº∏Âá∫ÂÖ©Âè•Ë©±ÔºåÁÑ∂ÂæåÂõûÂà∞mainÂáΩÊï∏Ôºå‰πüÊòØÊé•ÁùÄ‰∏äÊ¨°Âü∑Ë°åÂæåÁöÑÂú∞ÊñπÁπºÁ∫åÂü∑Ë°å„ÄÇÈÄôÈ©óË≠â‰∫Ü‰πãÂâç‰ª£Á¢ºË£èÈóúÊñºuser stateÂíåkernel stateÁöÑsaveÂíåloadÂãï‰Ωú„ÄÇ</li>
</ul>
<h3 id="04-Multitasking"><a href="#04-Multitasking" class="headerlink" title="04-Multitasking"></a>04-Multitasking</h3><p><img src="https://jjrcxq.bn.files.1drv.com/y4mxOrwfjpJWXVx10ewRnky1wPwqh2R11XAqx-rK7fYKhfnw0_Q74JArry9kVVn4BgN9X-_uc522FXUMVpDK12AMd4YZJsgAQUcUVqHyS46IaGAxRHw-BAwiecYzVgzOaHf2UiuOJ7Tpfs0_N-XTSa7WMGoHru9BdASIGz_T5kmQcuOST6itBFfUUH9IMIbg8uY6Jqo4lWKAnkXSwQfbY6U-Q?width=710&amp;height=457&amp;cropmode=none" alt></p>
<ul>
<li><p>diff context_switch.S ../03-ContextSwitch-2/context_switch.S ÔºåÁôºÁèæÔºö</p>
<ul>
<li>svc_handler‰∏≠ÁöÑmsr psr, ipËÆäÊàê‰∫Ümsr psr_nzcvq, ipÔºå<a href="http://infocenter.arm.com/help/topic/com.arm.doc.qrc0001mc/QRC0001_UAL.pdf" target="_blank" rel="noopener">nzcv</a>Áà≤psrÁöÑÂõõÂÄãÊ®ôË™å‰Ωç</li>
</ul>
</li>
<li><p>Âè¶Â§ñÂú®activate‰∏≠ÔºåÂú®ÂàáÊèõÂà∞process staskÂæåÂ§ö‰∏ÄÊ¢ùisbÊåá‰ª§Ôºö</p>
<p>Instruction Synchronization Barrier flushes the pipeline in the processor, so that all instructions following the ISB are fetched from cache or memory, after the instruction has been completed. It ensures that the effects of context altering operations, such as changing the ASID, or completed TLB maintenance operations, or branch predictor maintenance operations, as well as all changes to the CP15 registers, executed before the ISB instruction are visible to the instructions fetched after the ISB.<br>In addition, the ISB instruction ensures that any branches that appear in program order after it are always written into the branch prediction logic with the context that is visible after the ISB instruction. This is required to ensure correct execution of the instruction stream.</p>
</li>
<li><p>ÈáçÈ†≠Êà≤Âú®os.cÔºåÈ¶ñÂÖàÂÆèÂÆöÁæ©‰∫Ü‰∏âÂÄãÂú∞ÂùÄÔºö</p>
</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> HANDLER_MSP 0xFFFFFFF1</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> THREAD_MSP  0xFFFFFFF9</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> THREAD_PSP  0xFFFFFFFD</span></span><br></pre></td></tr></table></figure>
<p><img src="https://jjrbxq.bn.files.1drv.com/y4muhuffNAohfnDo-aRDoceuibQPrQEckKbjI4lHjnPFIs9WGd06YSErr1D8mnXD44UqViR2HMQmQ4_wvzsxaCkigz4_EXVvtf8zNBv0r4nCwYj0vwSCu8gaLkmEC28hMXaJ9VXQf0hhqjehXva9wzBL_zppfNl8mBUBl447u-Ml279njbjec48_ELzLOrV7Vcx3spyKlothXlN8JfhBB-NiQ?width=524&amp;height=422&amp;cropmode=none" alt></p>
<ul>
<li>Êé•ÁùÄÊñ∞Âª∫‰∏ÄÂÄãtaskÔºö</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">unsigned</span> <span class="keyword">int</span> *<span class="title">create_task</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">int</span> *<span class="built_in">stack</span>, <span class="keyword">void</span> (*start)(<span class="keyword">void</span>))</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">int</span> first = <span class="number">1</span>;</span><br><span class="line">        <span class="built_in">stack</span> += STACK_SIZE - <span class="number">32</span>; <span class="comment">/* End of stack, minus what we are about to push */</span></span><br><span class="line">        <span class="keyword">if</span> (first) &#123;</span><br><span class="line">                <span class="built_in">stack</span>[<span class="number">8</span>] = (<span class="keyword">unsigned</span> <span class="keyword">int</span>) start;</span><br><span class="line">                first = <span class="number">0</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="built_in">stack</span>[<span class="number">8</span>] = (<span class="keyword">unsigned</span> <span class="keyword">int</span>) THREAD_PSP;</span><br><span class="line">                <span class="built_in">stack</span>[<span class="number">15</span>] = (<span class="keyword">unsigned</span> <span class="keyword">int</span>) start;</span><br><span class="line">                <span class="built_in">stack</span>[<span class="number">16</span>] = (<span class="keyword">unsigned</span> <span class="keyword">int</span>) <span class="number">0x01000000</span>; <span class="comment">/* PSR Thumb bit */</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">stack</span> = activate(<span class="built_in">stack</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">stack</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ËÄåÂú®mainÂáΩÊï∏‰∏≠ÔºåÂ∞çÊáâÁöÑË™øÁî®ÊòØÔºö</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ÂÆöÁæ©‰∫ÜÁ®ãÂºèstackÁöÑÊï∏Èáè(2ÂÄã)ÂíåÂ§ßÂ∞è(256*4bytes)</span></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> user_stacks[TASK_LIMIT][STACK_SIZE];</span><br><span class="line"><span class="comment">//ÂÆöÁæ©‰∫ÜÁî®Êà∂Á®ãÂºèÁöÑÊï∏Èáè(2ÂÄã)</span></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> *usertasks[TASK_LIMIT];</span><br><span class="line"><span class="comment">//Â∞á‰πãÂâçÂÆöÁæ©ÁöÑstackÂíåfunctionÂú∞ÂùÄÂÇ≥Áµ¶create_taskÈÖçÁΩÆ</span></span><br><span class="line">usertasks[<span class="number">0</span>]=create_task(user_stack[<span class="number">0</span>],&amp;task_func);</span><br></pre></td></tr></table></figure>
<ul>
<li>Áï∂‰ΩøÁî®create_taskÂáΩÊï∏Á¨¨‰∏ÄÊ¨°ÈÄ≤Ë°åÂàùÂßãÂåñÊôÇÔºåÂú®create_task‰∏≠Â∞çtaskÁöÑstackÈÄ≤Ë°å‰∫ÜÈÖçÁΩÆÔºå‰∏¶‰∏îÂõ†Áà≤ÊòØÁ¨¨‰∏ÄÊ¨°Ë®≠ÂÆöÔºåÂ∞ástack[8]Â≠òÊîæ‰∫Ütask_funcÁöÑÂú∞ÂùÄÔºåÁÑ∂ÂæåÈÄ≤ÂÖ•Âà∞task_func‰∏≠echo‚Äùtask1 Created‚Äù&amp;‚Äùreturn‚ÄùÂæåË™øÁî®syscallÂõûÂà∞‰∫ÜmainÂáΩÊï∏„ÄÇ</li>
<li>Áï∂Á¨¨‰∫åÊ¨°ÂëºÂè´create_taskÊôÇÔºåcomment‰πüÊúâË™™ÊòéÔºåÂõ†Áà≤activateÊòØÂæûexception‰∏≠ËøîÂõûÔºåÊïÖÂ∞álr‰øùÂ≠òÁà≤THREAD_PSPÔºåËÄåÊ≠§ÊôÇÁöÑfuncÂæûstack[15]ÈñãÂßã</li>
<li>Áà≤‰ΩïÁ∑äÊé•ÁùÄÁöÑstack[16]Â∞±Ë¶ÅË®≠epsrÁà≤0x01000000ÔºüÁà≤‰ΩïprocessorÂèØ‰ª•Ë™çÂá∫ÈÄôÊ¢ùÊåá‰ª§ÊòØË®≠ÁΩÆesprÁöÑÔºü<ul>
<li>The following can clear the T bit to 0: (1)instructionsBLX, BX and POP{PC} (2)restoration from the stacked xPSR value on an exception return (3)bit[0] of the vector value on an exception entry or reset. ÊâÄ‰ª•ÈúÄË¶ÅÂÜçÂ∞áepsrË®≠Áà≤thumb state„ÄÇ</li>
</ul>
</li>
</ul>
<h3 id="05-TimerInterrupt"><a href="#05-TimerInterrupt" class="headerlink" title="05-TimerInterrupt"></a>05-TimerInterrupt</h3><ul>
<li><p>È¶ñÂÖàÁúãÂïìÂãïÊñá‰ª∂ÔºåÂ§ö‰∫ÜpendsvÂíåsystickÁöÑÂÆöÁæ©ÔºåÈóúÊñº<a href="http://infocenter.arm.com/help/index.jsp?topic=/com.arm.doc.dui0553a/BABBGBEC.html" target="_blank" rel="noopener">Cortex-M3Ë®≠ÂÇôÁöÑÁï∞Â∏∏È°ûÂûã</a>ÂÜçË§áÁøí‰∏Ä‰∏ã</p>
</li>
<li><p>void __attribute__((interrupt)) systick_handler(void)</p>
<ul>
<li>The compiler generates function entry and exit sequences suitable for use in an interrupt handler when this attribute is present. With Epiphany targets it may also generate a special section with code to initialize the interrupt vector table.(<a href="https://gcc.gnu.org/onlinedocs/gcc/Function-Attributes.html" target="_blank" rel="noopener">https://gcc.gnu.org/onlinedocs/gcc/Function-Attributes.html</a>)</li>
</ul>
</li>
</ul>
<h3 id="06-Preemptive"><a href="#06-Preemptive" class="headerlink" title="06-Preemptive"></a>06-Preemptive</h3><ul>
<li>Âú®context_switch.s‰∏≠Â∞çsystick_handlerÂÆöÁæ©‰∫Ü‰∏ÄÊ®£ÁöÑË°åÁà≤ÔºåÁï∂systick exceptionËß∏ÁôºÊôÇÔºå‰πüÊúÉÂ∞áÈÄ≤Á®ãÂàáÊèõÂà∞kernel mode„ÄÇ</li>
<li>‰∏ÄÁõ¥Ê≤íÊâæÂà∞delay()ÂíåsystickÊúâ‰ªÄÈ∫ºÁõ¥Êé•ËÅØÁπ´ÔºåÊÅçÁÑ∂Â§ßÊÇüÔºöÁï∂‰∏ÄÂÄãtaskÂú®ÈÅãË°åÊôÇÔºåÁî±ÊñºÁôºÁîü‰∫Üsystick exceptionÔºåÂ∞±ÊúÉÂàáÊèõÂà∞kernel modeÁÑ∂ÂæåÈÅãË°å‰∏ã‰∏ÄÂÄãtaskÔºåÈÄôÊ®£Â∞±Â¶ÇÂêåpreemptive„ÄÇ</li>
</ul>

      
    </div>

    
      

  <div class="popular-posts-header">Áõ∏ÂÖ≥ÊñáÁ´†</div>
  <ul class="popular-posts">
  
    <li class="popular-posts-item">
      
      
      <div class="popular-posts-title"><a href="/2019/am335x-arm-cortex-a8-boot-sequence/" rel="bookmark">Ëß£ÊûêAM335x Arm Cortex-A8Â§ÑÁêÜÂô®ÁöÑÂêØÂä®ÊµÅÁ®ã</a></div>
      
    </li>
  
    <li class="popular-posts-item">
      
      
      <div class="popular-posts-title"><a href="/2020/lab-compiler-intro/" rel="bookmark">ÁºñËØëÂô®ÂÖ•Èó®Â∞èÁ¨îËÆ∞</a></div>
      
    </li>
  
    <li class="popular-posts-item">
      
      
      <div class="popular-posts-title"><a href="/2019/watching-notes-revolution-os/" rel="bookmark">ËßÇÂΩ±ÁÆÄËÆ∞Ôºö„ÄäRevolution OSÔºàÊìç‰ΩúÁ≥ªÁªüÈù©ÂëΩÔºâ„Äã</a></div>
      
    </li>
  
    <li class="popular-posts-item">
      
      
      <div class="popular-posts-title"><a href="/2020/lab-leetcode-practices/" rel="bookmark">LeetCodeÂ∞èÁªÉ‰π†</a></div>
      
    </li>
  
    <li class="popular-posts-item">
      
      
      <div class="popular-posts-title"><a href="/2020/lab-prefetch-intro/" rel="bookmark">PrefetcherÂ∞èÁªÉ‰π†</a></div>
      
    </li>
  
  </ul>


    

    
    
    

    

    
      
    
    
      <div>
        <div id="reward-container">
  <div>Buy me a cup of coffee :)</div>
  <button id="reward-button" disable="enable" onclick="var qr = document.getElementById(&quot;qr&quot;); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">
    ÊâìËµè
  </button>
  <div id="qr" style="display: none;">

    
      
      
        
      
      <div style="display: inline-block">
        <img src="/images/reward-wechat.jpg" alt="John Chou ÂæÆ‰ø°ÊîØ‰ªò">
        <p>ÂæÆ‰ø°ÊîØ‰ªò</p>
      </div>
    
      
      
        
      
      <div style="display: inline-block">
        <img src="/images/reward-alipay.jpg" alt="John Chou ÊîØ‰ªòÂÆù">
        <p>ÊîØ‰ªòÂÆù</p>
      </div>
    

  </div>
</div>

      </div>
    

    
      <div>
        




  



<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>Êú¨Êñá‰ΩúËÄÖÔºö </strong>John Chou</li>
  <li class="post-copyright-link">
    <strong>Êú¨ÊñáÈìæÊé•Ôºö</strong>
    
    <a href="https://blog.joouis.com/2019/lab-mini-arm-os/" title="‰∏äÊâã‰∏Ä‰∏™ÂÖ∑‰ΩìËÄåÂæÆÁöÑARMÊìç‰ΩúÁ≥ªÁªü">https://blog.joouis.com/2019/lab-mini-arm-os/</a>
  </li>
  <li class="post-copyright-license">
    <strong>ÁâàÊùÉÂ£∞ÊòéÔºö </strong>Êú¨ÂçöÂÆ¢ÊâÄÊúâÊñáÁ´†Èô§ÁâπÂà´Â£∞ÊòéÂ§ñÔºåÂùáÈááÁî® <a href="https://creativecommons.org/licenses/by-nd/4.0/" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i>BY-ND</a> ËÆ∏ÂèØÂçèËÆÆ„ÄÇËΩ¨ËΩΩËØ∑Ê≥®ÊòéÂá∫Â§ÑÔºÅ</li>
</ul>

      </div>
    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/embedded-system-course/" rel="tag"># embedded system course</a>
          
            <a href="/tags/embedded-system/" rel="tag"># embedded system</a>
          
            <a href="/tags/arm/" rel="tag"># arm</a>
          
            <a href="/tags/os/" rel="tag"># os</a>
          
            <a href="/tags/gnu/" rel="tag"># gnu</a>
          
            <a href="/tags/context-switch/" rel="tag"># context switch</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/am335x-arm-cortex-a8-boot-sequence/" rel="next" title="Ëß£ÊûêAM335x Arm Cortex-A8Â§ÑÁêÜÂô®ÁöÑÂêØÂä®ÊµÅÁ®ã">
                <i class="fa fa-chevron-left"></i> Ëß£ÊûêAM335x Arm Cortex-A8Â§ÑÁêÜÂô®ÁöÑÂêØÂä®ÊµÅÁ®ã
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2020/lab-compiler-intro/" rel="prev" title="ÁºñËØëÂô®ÂÖ•Èó®Â∞èÁ¨îËÆ∞">
                ÁºñËØëÂô®ÂÖ•Èó®Â∞èÁ¨îËÆ∞ <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  
    <div class="comments" id="comments">
      <div id="disqus_thread">
        <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
      </div>
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            ÊñáÁ´†ÁõÆÂΩï
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Á´ôÁÇπÊ¶ÇËßà
          </li>
        </ul>
      

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/avatar.jpg" alt="John Chou">
            
              <p class="site-author-name" itemprop="name">John Chou</p>
              <div class="site-description motion-element" itemprop="description">Stand high, think different.</div>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">50</span>
                    <span class="site-state-item-name">Êó•Âøó</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  
                    
                      <a href="/categories/">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">7</span>
                    <span class="site-state-item-name">ÂàÜÁ±ª</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  
                    
                      <a href="/tags/">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">179</span>
                    <span class="site-state-item-name">Ê†áÁ≠æ</span>
                  </a>
                </div>
              
            </nav>
          

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  
                  
                  
                    
                  
                  <a href="https://github.com/Joouis" title="GitHub &rarr; https://github.com/Joouis" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i></a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                  
                    
                  
                  <a href="mailto:luckyjoou@gmail.com" title="E-Mail &rarr; mailto:luckyjoou@gmail.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i></a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                  
                    
                  
                  <a href="https://www.instagram.com/Joouis" title="Instagram &rarr; https://www.instagram.com/Joouis" rel="noopener" target="_blank"><i class="fa fa-fw fa-instagram"></i></a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                  
                    
                  
                  <a href="http://www.slideshare.net/choujohn351" title="SlideShare &rarr; http://www.slideshare.net/choujohn351" rel="noopener" target="_blank"><i class="fa fa-fw fa-slideshare"></i></a>
                </span>
              
            </div>
          

          
             <div class="cc-license motion-element" itemprop="license">
              
              
                
              
              
              
              <a href="https://creativecommons.org/licenses/by-nd/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nd.svg" alt="Creative Commons"></a>
             </div>
          

          
          

          
            
          
          

        </div>
      </div>

      
      <!--noindex-->
        <div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
            
            
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#ÂáÜÂ§áÂ∑•‰Ωú"><span class="nav-number">1.</span> <span class="nav-text">ÂáÜÂ§áÂ∑•‰Ωú</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Mini-ARM-OS"><span class="nav-number">2.</span> <span class="nav-text">Mini ARM OS</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#00-HelloWorld"><span class="nav-number">2.1.</span> <span class="nav-text">00-HelloWorld</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#01-HelloWorld"><span class="nav-number">2.2.</span> <span class="nav-text">01-HelloWorld</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#02-ContextSwitch-1"><span class="nav-number">2.3.</span> <span class="nav-text">02-ContextSwitch-1</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#03-ContextSwitch-2"><span class="nav-number">2.4.</span> <span class="nav-text">03-ContextSwitch-2</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#04-Multitasking"><span class="nav-number">2.5.</span> <span class="nav-text">04-Multitasking</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#05-TimerInterrupt"><span class="nav-number">2.6.</span> <span class="nav-text">05-TimerInterrupt</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#06-Preemptive"><span class="nav-number">2.7.</span> <span class="nav-text">06-Preemptive</span></a></li></ol></li></ol></div>
            

          </div>
        </div>
      <!--/noindex-->
      

      

    </div>
  </aside>
  
    <div id="sidebar-dimmer"></div>
  


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2016 ‚Äì <span itemprop="copyrightYear">2020</span>
  <span class="with-love" id="animate">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">John Chou</span>

  

  
</div>









        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>












  















  
  <script src="//cdn.jsdelivr.net/npm/jquery@2/dist/jquery.min.js"></script>

  
  <script src="//cdn.jsdelivr.net/npm/velocity-animate@1/velocity.min.js"></script>

  
  <script src="//cdn.jsdelivr.net/npm/velocity-animate@1/velocity.ui.min.js"></script>

  
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>


  


  <script src="/js/utils.js?v=7.1.0"></script>

  <script src="/js/motion.js?v=7.1.0"></script>



  
  


  <script src="/js/schemes/muse.js?v=7.1.0"></script>




  
  <script src="/js/scrollspy.js?v=7.1.0"></script>
<script src="/js/post-details.js?v=7.1.0"></script>



  


  <script src="/js/next-boot.js?v=7.1.0"></script>


  
  <script src="/js/js.cookie.js?v=7.1.0"></script>
  <script src="/js/scroll-cookie.js?v=7.1.0"></script>


  

  
  
  
    
  

  

  
  
  


  
  

<script>
  var disqus_config = function() {
    this.page.url = "https://blog.joouis.com/2019/lab-mini-arm-os/";
    this.page.identifier = "2019/lab-mini-arm-os/";
    this.page.title = '‰∏äÊâã‰∏Ä‰∏™ÂÖ∑‰ΩìËÄåÂæÆÁöÑARMÊìç‰ΩúÁ≥ªÁªü';
    };
  function loadComments() {
    var d = document, s = d.createElement('script');
    s.src = 'https://joou.disqus.com/embed.js';
    s.setAttribute('data-timestamp', '' + +new Date());
    (d.head || d.body).appendChild(s);
  }
  
    loadComments();
  
</script>





  


  
  <script>
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url).replace(/\/{2,}/g, '/');
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x"></i></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x"></i></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  

  

  
  <script>
    (function(){
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      bp.src = (curProtocol === 'https') ? 'https://zz.bdstatic.com/linksubmit/push.js' : 'http://push.zhanzhang.baidu.com/push.js';
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
    })();
  </script>


  

  

  

  
  
  
    
  
  <script src="//cdn.jsdelivr.net/npm/pangu@4/dist/browser/pangu.min.js"></script>
  <script>pangu.spacingPage();</script>


  

  
<script>
  $('.highlight').each(function(i, e) {
    var $wrap = $('<div>').addClass('highlight-wrap');
    $(e).after($wrap);
    $wrap.append($('<button>').addClass('copy-btn').append('Â§çÂà∂').on('click', function(e) {
      var code = $(this).parent().find('.code').find('.line').map(function(i, e) {
        return $(e).text();
      }).toArray().join('\n');
      var ta = document.createElement('textarea');
      var yPosition = window.pageYOffset || document.documentElement.scrollTop;
      ta.style.top = yPosition + 'px'; // Prevent page scroll
      ta.style.position = 'absolute';
      ta.style.opacity = '0';
      ta.readOnly = true;
      ta.value = code;
      document.body.appendChild(ta);
      ta.select();
      ta.setSelectionRange(0, code.length);
      ta.readOnly = false;
      var result = document.execCommand('copy');
      
        if (result) $(this).text('Â§çÂà∂ÊàêÂäü');
        else $(this).text('Â§çÂà∂Â§±Ë¥•');
      
      ta.blur(); // For iOS
      $(this).blur();
    })).on('mouseleave', function(e) {
      var $b = $(this).find('.copy-btn');
      setTimeout(function() {
        $b.text('Â§çÂà∂');
      }, 300);
    }).append(e);
  })
</script>


  

  

</body>
</html>
